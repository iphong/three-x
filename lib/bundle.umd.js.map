{"version":3,"sources":["webpack://ThreeX/webpack/universalModuleDefinition","webpack://ThreeX/webpack/bootstrap","webpack://ThreeX/./node_modules/three/examples/js/loaders/ColladaLoader.js","webpack://ThreeX/./src/File3D.js","webpack://ThreeX/./src/Floor3D.js","webpack://ThreeX/./src/Object3D.js","webpack://ThreeX/./src/Scene3D.js","webpack://ThreeX/./src/Sky3D.js","webpack://ThreeX/./src/index.js","webpack://ThreeX/external {\"commonjs\":\"prop-types\",\"commonjs2\":\"prop-types\",\"amd\":\"prop-types\"}","webpack://ThreeX/external {\"commonjs\":\"react\",\"commonjs2\":\"react\",\"amd\":\"react\",\"root\":\"React\"}","webpack://ThreeX/external {\"commonjs\":\"three\",\"commonjs2\":\"three\",\"amd\":\"three\",\"root\":\"THREE\"}","webpack://ThreeX/external \"three/examples/js/controls/FlyControls\"","webpack://ThreeX/external \"three/examples/js/controls/MapControls\"","webpack://ThreeX/external \"three/examples/js/controls/OrbitControls\"","webpack://ThreeX/external \"three/examples/js/controls/PointerLockControls\"","webpack://ThreeX/external \"three/examples/js/loaders/MTLLoader\"","webpack://ThreeX/external \"three/examples/js/loaders/OBJLoader\"","webpack://ThreeX/external \"three/examples/js/objects/Sky\"","webpack://ThreeX/external \"three/src/helpers/GridHelper\""],"names":["THREE","ColladaLoader","manager","undefined","DefaultLoadingManager","prototype","constructor","crossOrigin","load","url","onLoad","onProgress","onError","scope","path","LoaderUtils","extractUrlBase","loader","FileLoader","text","parse","setPath","value","options","convertUpAxis","console","warn","setCrossOrigin","getElementsByTagName","xml","name","array","childNodes","i","l","length","child","nodeName","push","parseStrings","parts","trim","split","Array","parseFloats","parseFloat","parseInts","parseInt","parseId","substring","generateId","count","isEmpty","object","Object","keys","parseAsset","unit","parseAssetUnit","upAxis","parseAssetUpAxis","hasAttribute","getAttribute","textContent","parseLibrary","libraryName","parser","library","elements","buildLibrary","data","builder","build","getBuild","parseAnimation","sources","samplers","channels","nodeType","id","parseSource","parseAnimationSampler","parseAnimationChannel","log","animations","inputs","semantic","target","shift","sid","arraySyntax","indexOf","memberSyntax","member","indices","replace","sampler","buildAnimation","tracks","hasOwnProperty","channel","inputId","INPUT","outputId","OUTPUT","inputSource","outputSource","animation","buildAnimationChannel","createKeyframeTracks","getAnimation","node","nodes","object3D","getNode","transform","transforms","defaultMatrix","matrix","clone","transpose","time","stride","il","j","jl","index","keyframes","prepareAnimationData","uuid","sort","ascending","transformAnimationData","a","b","position","Vector3","scale","quaternion","Quaternion","times","positionData","quaternionData","scaleData","keyframe","fromArray","decompose","x","y","z","w","VectorKeyframeTrack","QuaternionKeyframeTrack","property","defaultValue","empty","createMissingKeyframes","prev","next","getPrev","getNext","interpolate","key","parseAnimationClip","start","end","clips","buildAnimationClip","duration","animationTracks","AnimationClip","getAnimationClip","parseController","skin","parseSkin","controllers","bindShapeMatrix","joints","parseJoints","vertexWeights","parseVertexWeights","offset","vcount","v","buildController","geometry","geometries","buildSkin","skinIndices","skinWeights","weights","BONE_LIMIT","jointOffset","JOINT","weightOffset","WEIGHT","jointSource","inverseSource","INV_BIND_MATRIX","jointCount","vertexSkinData","skinIndex","weightId","skinWeight","weight","descending","d","bindMatrix","Matrix4","boneInverse","getController","parseImage","init_from","images","buildImage","getImage","parseEffect","profile","parseEffectProfileCOMMON","effects","surfaces","parseEffectNewparam","technique","parseEffectTechnique","extra","parseEffectExtra","parseEffectSurface","parseEffectSampler","source","type","parameters","parseEffectParameters","parseEffectParameter","opaque","parseEffectParameterTexture","parseEffectParameterTextureExtra","parseEffectParameterTextureExtraTechnique","toUpperCase","parseEffectExtraTechnique","buildEffect","getEffect","parseMaterial","materials","buildMaterial","effect","material","MeshPhongMaterial","MeshLambertMaterial","MeshBasicMaterial","getTexture","textureObject","image","surface","texture","textureLoader","wrapS","wrapU","RepeatWrapping","ClampToEdgeWrapping","wrapT","wrapV","set","offsetU","offsetV","repeat","repeatU","repeatV","parameter","color","map","specular","specularMap","float","shininess","emissive","emissiveMap","transparent","transparency","opacity","double_sided","side","DoubleSide","getMaterial","parseCamera","optics","parseCameraOptics","cameras","parseCameraTechnique","parseCameraParameters","buildCamera","camera","PerspectiveCamera","yfov","aspect_ratio","znear","zfar","ymag","xmag","aspectRatio","OrthographicCamera","getCamera","parseLight","parseLightTechnique","lights","parseLightParameters","Color","falloffAngle","f","distance","Math","sqrt","buildLight","light","DirectionalLight","PointLight","SpotLight","AmbientLight","copy","getLight","parseGeometry","vertices","primitives","mesh","parseGeometryVertices","parseGeometryPrimitive","accessor","primitive","hasUV","max","p","groupPrimitives","checkUVCoordinates","uvsNeedsFix","buildGeometry","groupedPrimitives","primitiveType","buildGeometryType","normal","uv","BufferGeometry","materialKeys","g","vc","addGroup","input","prevLength","buildGeometryData","addAttribute","Float32BufferAttribute","pushVector","sourceStride","sourceArray","c","k","kl","getGeometry","parseKinematicsModel","links","parseKinematicsTechniqueCommon","kinematicsModels","buildKinematicsModel","getKinematicsModel","parseKinematicsJoint","parseKinematicsLink","parseKinematicsJointParameter","axis","limits","min","static","zeroPosition","middlePosition","attachments","parseKinematicsAttachment","parseKinematicsTransform","joint","pop","obj","angle","degToRad","parsePhysicsModel","rigidBodies","parsePhysicsRigidBody","physicsModels","parsePhysicsTechniqueCommon","inertia","mass","parseKinematicsScene","bindJointAxis","parseKinematicsBindJointAxis","kinematicsScenes","param","tmpJointIndex","jointIndex","substr","buildKinematicsScene","getKinematicsScene","setupKinematics","kinematicsModelId","kinematicsSceneId","visualSceneId","visualScenes","kinematicsModel","kinematicsScene","visualScene","getVisualScene","jointMap","targetElement","collada","querySelector","parentVisualElement","parentElement","connect","visualElement","visualElementName","traverse","buildTransformList","m0","kinematics","getJointValue","jointData","setJointValue","identity","multiply","makeRotationAxis","makeTranslation","vector","prepareNodes","element","setAttribute","parseNode","instanceCameras","instanceControllers","instanceLights","instanceGeometries","instanceNodes","parseNodeInstance","skeletons","instances","instance","symbol","buildSkeleton","boneData","sortedBoneData","skeleton","root","hasNode","buildBoneHierarchy","hasVisualScene","children","error","bone","processed","bones","boneInverses","Skeleton","isBone","buildNode","objects","instanceCamera","controller","newObjects","buildObjects","isSkinnedMesh","bind","normalizeSkinWeights","instanceLight","Bone","Group","add","resolveMaterialBinding","instanceMaterials","LineBasicMaterial","skinning","attributes","LineSegments","Line","SkinnedMesh","Mesh","parseVisualScene","buildVisualScene","group","parseScene","setupAnimations","scene","Scene","DOMParser","parseFromString","version","asset","TextureLoader","setFromEuler","Euler","PI","multiplyScalar","window","m","Three","MeshNormalMaterial","File3D","OBJLoader","MTLLoader","castShadow","receiveShadow","isArray","forEach","enhance","componentDidMount","matLoader","props","mtl","objLoader","setMaterials","parent","Floor3D","MeshPhysicalMaterial","PlaneBufferGeometry","plane","rotation","grid","GridHelper","mapping","UVMapping","needsUpdate","ParentContext","React","createContext","Object3D","Component","getChildContext","context","update","componentDidUpdate","componentWillUnmount","remove","render","PropTypes","instanceOf","Scene3D","Clock","createRef","WebGLRenderer","antialias","width","innerWidth","height","innerHeight","fov","far","near","aspect","updateProjectionMatrix","renderer","setSize","shadowMap","enabled","mounted","requestAnimationFrame","animate","e","wrapper","current","appendChild","domElement","addEventListener","removeEventListener","handleClick","bool","controls","oneOf","number","zoom","Sky3D","Sky","HemisphereLight","assign","sky","ambient","inclination","azimuth","turbidity","rayleigh","luminance","mieCoefficient","mieDirectionalG","theta","phi","sunX","cos","sunY","sin","sunZ","setScalar","uniforms","sunPosition","intensity","setHSL","shadow","mapSize","groundColor","propTypes","defaultProps"],"mappings":"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","file":"bundle.umd.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"prop-types\"), require(\"react\"), require(\"three\"), require(\"three/examples/js/controls/FlyControls\"), require(\"three/examples/js/controls/MapControls\"), require(\"three/examples/js/controls/OrbitControls\"), require(\"three/examples/js/controls/PointerLockControls\"), require(\"three/examples/js/loaders/MTLLoader\"), require(\"three/examples/js/loaders/OBJLoader\"), require(\"three/examples/js/objects/Sky\"), require(\"three/src/helpers/GridHelper\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"prop-types\", \"react\", \"three\", \"three/examples/js/controls/FlyControls\", \"three/examples/js/controls/MapControls\", \"three/examples/js/controls/OrbitControls\", \"three/examples/js/controls/PointerLockControls\", \"three/examples/js/loaders/MTLLoader\", \"three/examples/js/loaders/OBJLoader\", \"three/examples/js/objects/Sky\", \"three/src/helpers/GridHelper\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ThreeX\"] = factory(require(\"prop-types\"), require(\"react\"), require(\"three\"), require(\"three/examples/js/controls/FlyControls\"), require(\"three/examples/js/controls/MapControls\"), require(\"three/examples/js/controls/OrbitControls\"), require(\"three/examples/js/controls/PointerLockControls\"), require(\"three/examples/js/loaders/MTLLoader\"), require(\"three/examples/js/loaders/OBJLoader\"), require(\"three/examples/js/objects/Sky\"), require(\"three/src/helpers/GridHelper\"));\n\telse\n\t\troot[\"ThreeX\"] = factory(root[undefined], root[\"React\"], root[\"THREE\"], root[\"three/examples/js/controls/FlyControls\"], root[\"three/examples/js/controls/MapControls\"], root[\"three/examples/js/controls/OrbitControls\"], root[\"three/examples/js/controls/PointerLockControls\"], root[\"three/examples/js/loaders/MTLLoader\"], root[\"three/examples/js/loaders/OBJLoader\"], root[\"three/examples/js/objects/Sky\"], root[\"three/src/helpers/GridHelper\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE_prop_types__, __WEBPACK_EXTERNAL_MODULE_react__, __WEBPACK_EXTERNAL_MODULE_three__, __WEBPACK_EXTERNAL_MODULE_three_examples_js_controls_FlyControls__, __WEBPACK_EXTERNAL_MODULE_three_examples_js_controls_MapControls__, __WEBPACK_EXTERNAL_MODULE_three_examples_js_controls_OrbitControls__, __WEBPACK_EXTERNAL_MODULE_three_examples_js_controls_PointerLockControls__, __WEBPACK_EXTERNAL_MODULE_three_examples_js_loaders_MTLLoader__, __WEBPACK_EXTERNAL_MODULE_three_examples_js_loaders_OBJLoader__, __WEBPACK_EXTERNAL_MODULE_three_examples_js_objects_Sky__, __WEBPACK_EXTERNAL_MODULE_three_src_helpers_GridHelper__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","/**\n * @author mrdoob / http://mrdoob.com/\n * @author Mugen87 / https://github.com/Mugen87\n */\n\nTHREE.ColladaLoader = function ( manager ) {\n\n\tthis.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\n\n};\n\nTHREE.ColladaLoader.prototype = {\n\n\tconstructor: THREE.ColladaLoader,\n\n\tcrossOrigin: 'anonymous',\n\n\tload: function ( url, onLoad, onProgress, onError ) {\n\n\t\tvar scope = this;\n\n\t\tvar path = scope.path === undefined ? THREE.LoaderUtils.extractUrlBase( url ) : scope.path;\n\n\t\tvar loader = new THREE.FileLoader( scope.manager );\n\t\tloader.load( url, function ( text ) {\n\n\t\t\tonLoad( scope.parse( text, path ) );\n\n\t\t}, onProgress, onError );\n\n\t},\n\n\tsetPath: function ( value ) {\n\n\t\tthis.path = value;\n\t\treturn this;\n\n\t},\n\n\toptions: {\n\n\t\tset convertUpAxis( value ) {\n\n\t\t\tconsole.warn( 'THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.' );\n\n\t\t}\n\n\t},\n\n\tsetCrossOrigin: function ( value ) {\n\n\t\tthis.crossOrigin = value;\n\t\treturn this;\n\n\t},\n\n\tparse: function ( text, path ) {\n\n\t\tfunction getElementsByTagName( xml, name ) {\n\n\t\t\t// Non recursive xml.getElementsByTagName() ...\n\n\t\t\tvar array = [];\n\t\t\tvar childNodes = xml.childNodes;\n\n\t\t\tfor ( var i = 0, l = childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = childNodes[ i ];\n\n\t\t\t\tif ( child.nodeName === name ) {\n\n\t\t\t\t\tarray.push( child );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn array;\n\n\t\t}\n\n\t\tfunction parseStrings( text ) {\n\n\t\t\tif ( text.length === 0 ) return [];\n\n\t\t\tvar parts = text.trim().split( /\\s+/ );\n\t\t\tvar array = new Array( parts.length );\n\n\t\t\tfor ( var i = 0, l = parts.length; i < l; i ++ ) {\n\n\t\t\t\tarray[ i ] = parts[ i ];\n\n\t\t\t}\n\n\t\t\treturn array;\n\n\t\t}\n\n\t\tfunction parseFloats( text ) {\n\n\t\t\tif ( text.length === 0 ) return [];\n\n\t\t\tvar parts = text.trim().split( /\\s+/ );\n\t\t\tvar array = new Array( parts.length );\n\n\t\t\tfor ( var i = 0, l = parts.length; i < l; i ++ ) {\n\n\t\t\t\tarray[ i ] = parseFloat( parts[ i ] );\n\n\t\t\t}\n\n\t\t\treturn array;\n\n\t\t}\n\n\t\tfunction parseInts( text ) {\n\n\t\t\tif ( text.length === 0 ) return [];\n\n\t\t\tvar parts = text.trim().split( /\\s+/ );\n\t\t\tvar array = new Array( parts.length );\n\n\t\t\tfor ( var i = 0, l = parts.length; i < l; i ++ ) {\n\n\t\t\t\tarray[ i ] = parseInt( parts[ i ] );\n\n\t\t\t}\n\n\t\t\treturn array;\n\n\t\t}\n\n\t\tfunction parseId( text ) {\n\n\t\t\treturn text.substring( 1 );\n\n\t\t}\n\n\t\tfunction generateId() {\n\n\t\t\treturn 'three_default_' + ( count ++ );\n\n\t\t}\n\n\t\tfunction isEmpty( object ) {\n\n\t\t\treturn Object.keys( object ).length === 0;\n\n\t\t}\n\n\t\t// asset\n\n\t\tfunction parseAsset( xml ) {\n\n\t\t\treturn {\n\t\t\t\tunit: parseAssetUnit( getElementsByTagName( xml, 'unit' )[ 0 ] ),\n\t\t\t\tupAxis: parseAssetUpAxis( getElementsByTagName( xml, 'up_axis' )[ 0 ] )\n\t\t\t};\n\n\t\t}\n\n\t\tfunction parseAssetUnit( xml ) {\n\n\t\t\tif ( ( xml !== undefined ) && ( xml.hasAttribute( 'meter' ) === true ) ) {\n\n\t\t\t\treturn parseFloat( xml.getAttribute( 'meter' ) );\n\n\t\t\t} else {\n\n\t\t\t\treturn 1; // default 1 meter\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parseAssetUpAxis( xml ) {\n\n\t\t\treturn xml !== undefined ? xml.textContent : 'Y_UP';\n\n\t\t}\n\n\t\t// library\n\n\t\tfunction parseLibrary( xml, libraryName, nodeName, parser ) {\n\n\t\t\tvar library = getElementsByTagName( xml, libraryName )[ 0 ];\n\n\t\t\tif ( library !== undefined ) {\n\n\t\t\t\tvar elements = getElementsByTagName( library, nodeName );\n\n\t\t\t\tfor ( var i = 0; i < elements.length; i ++ ) {\n\n\t\t\t\t\tparser( elements[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction buildLibrary( data, builder ) {\n\n\t\t\tfor ( var name in data ) {\n\n\t\t\t\tvar object = data[ name ];\n\t\t\t\tobject.build = builder( data[ name ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// get\n\n\t\tfunction getBuild( data, builder ) {\n\n\t\t\tif ( data.build !== undefined ) return data.build;\n\n\t\t\tdata.build = builder( data );\n\n\t\t\treturn data.build;\n\n\t\t}\n\n\t\t// animation\n\n\t\tfunction parseAnimation( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tsources: {},\n\t\t\t\tsamplers: {},\n\t\t\t\tchannels: {}\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tvar id;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'source':\n\t\t\t\t\t\tid = child.getAttribute( 'id' );\n\t\t\t\t\t\tdata.sources[ id ] = parseSource( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'sampler':\n\t\t\t\t\t\tid = child.getAttribute( 'id' );\n\t\t\t\t\t\tdata.samplers[ id ] = parseAnimationSampler( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'channel':\n\t\t\t\t\t\tid = child.getAttribute( 'target' );\n\t\t\t\t\t\tdata.channels[ id ] = parseAnimationChannel( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.log( child );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.animations[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction parseAnimationSampler( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tinputs: {},\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'input':\n\t\t\t\t\t\tvar id = parseId( child.getAttribute( 'source' ) );\n\t\t\t\t\t\tvar semantic = child.getAttribute( 'semantic' );\n\t\t\t\t\t\tdata.inputs[ semantic ] = id;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseAnimationChannel( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tvar target = xml.getAttribute( 'target' );\n\n\t\t\t// parsing SID Addressing Syntax\n\n\t\t\tvar parts = target.split( '/' );\n\n\t\t\tvar id = parts.shift();\n\t\t\tvar sid = parts.shift();\n\n\t\t\t// check selection syntax\n\n\t\t\tvar arraySyntax = ( sid.indexOf( '(' ) !== - 1 );\n\t\t\tvar memberSyntax = ( sid.indexOf( '.' ) !== - 1 );\n\n\t\t\tif ( memberSyntax ) {\n\n\t\t\t\t//  member selection access\n\n\t\t\t\tparts = sid.split( '.' );\n\t\t\t\tsid = parts.shift();\n\t\t\t\tdata.member = parts.shift();\n\n\t\t\t} else if ( arraySyntax ) {\n\n\t\t\t\t// array-access syntax. can be used to express fields in one-dimensional vectors or two-dimensional matrices.\n\n\t\t\t\tvar indices = sid.split( '(' );\n\t\t\t\tsid = indices.shift();\n\n\t\t\t\tfor ( var i = 0; i < indices.length; i ++ ) {\n\n\t\t\t\t\tindices[ i ] = parseInt( indices[ i ].replace( /\\)/, '' ) );\n\n\t\t\t\t}\n\n\t\t\t\tdata.indices = indices;\n\n\t\t\t}\n\n\t\t\tdata.id = id;\n\t\t\tdata.sid = sid;\n\n\t\t\tdata.arraySyntax = arraySyntax;\n\t\t\tdata.memberSyntax = memberSyntax;\n\n\t\t\tdata.sampler = parseId( xml.getAttribute( 'source' ) );\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildAnimation( data ) {\n\n\t\t\tvar tracks = [];\n\n\t\t\tvar channels = data.channels;\n\t\t\tvar samplers = data.samplers;\n\t\t\tvar sources = data.sources;\n\n\t\t\tfor ( var target in channels ) {\n\n\t\t\t\tif ( channels.hasOwnProperty( target ) ) {\n\n\t\t\t\t\tvar channel = channels[ target ];\n\t\t\t\t\tvar sampler = samplers[ channel.sampler ];\n\n\t\t\t\t\tvar inputId = sampler.inputs.INPUT;\n\t\t\t\t\tvar outputId = sampler.inputs.OUTPUT;\n\n\t\t\t\t\tvar inputSource = sources[ inputId ];\n\t\t\t\t\tvar outputSource = sources[ outputId ];\n\n\t\t\t\t\tvar animation = buildAnimationChannel( channel, inputSource, outputSource );\n\n\t\t\t\t\tcreateKeyframeTracks( animation, tracks );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn tracks;\n\n\t\t}\n\n\t\tfunction getAnimation( id ) {\n\n\t\t\treturn getBuild( library.animations[ id ], buildAnimation );\n\n\t\t}\n\n\t\tfunction buildAnimationChannel( channel, inputSource, outputSource ) {\n\n\t\t\tvar node = library.nodes[ channel.id ];\n\t\t\tvar object3D = getNode( node.id );\n\n\t\t\tvar transform = node.transforms[ channel.sid ];\n\t\t\tvar defaultMatrix = node.matrix.clone().transpose();\n\n\t\t\tvar time, stride;\n\t\t\tvar i, il, j, jl;\n\n\t\t\tvar data = {};\n\n\t\t\t// the collada spec allows the animation of data in various ways.\n\t\t\t// depending on the transform type (matrix, translate, rotate, scale), we execute different logic\n\n\t\t\tswitch ( transform ) {\n\n\t\t\t\tcase 'matrix':\n\n\t\t\t\t\tfor ( i = 0, il = inputSource.array.length; i < il; i ++ ) {\n\n\t\t\t\t\t\ttime = inputSource.array[ i ];\n\t\t\t\t\t\tstride = i * outputSource.stride;\n\n\t\t\t\t\t\tif ( data[ time ] === undefined ) data[ time ] = {};\n\n\t\t\t\t\t\tif ( channel.arraySyntax === true ) {\n\n\t\t\t\t\t\t\tvar value = outputSource.array[ stride ];\n\t\t\t\t\t\t\tvar index = channel.indices[ 0 ] + 4 * channel.indices[ 1 ];\n\n\t\t\t\t\t\t\tdata[ time ][ index ] = value;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tfor ( j = 0, jl = outputSource.stride; j < jl; j ++ ) {\n\n\t\t\t\t\t\t\t\tdata[ time ][ j ] = outputSource.array[ stride + j ];\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'translate':\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Animation transform type \"%s\" not yet implemented.', transform );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'rotate':\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Animation transform type \"%s\" not yet implemented.', transform );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'scale':\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Animation transform type \"%s\" not yet implemented.', transform );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tvar keyframes = prepareAnimationData( data, defaultMatrix );\n\n\t\t\tvar animation = {\n\t\t\t\tname: object3D.uuid,\n\t\t\t\tkeyframes: keyframes\n\t\t\t};\n\n\t\t\treturn animation;\n\n\t\t}\n\n\t\tfunction prepareAnimationData( data, defaultMatrix ) {\n\n\t\t\tvar keyframes = [];\n\n\t\t\t// transfer data into a sortable array\n\n\t\t\tfor ( var time in data ) {\n\n\t\t\t\tkeyframes.push( { time: parseFloat( time ), value: data[ time ] } );\n\n\t\t\t}\n\n\t\t\t// ensure keyframes are sorted by time\n\n\t\t\tkeyframes.sort( ascending );\n\n\t\t\t// now we clean up all animation data, so we can use them for keyframe tracks\n\n\t\t\tfor ( var i = 0; i < 16; i ++ ) {\n\n\t\t\t\ttransformAnimationData( keyframes, i, defaultMatrix.elements[ i ] );\n\n\t\t\t}\n\n\t\t\treturn keyframes;\n\n\t\t\t// array sort function\n\n\t\t\tfunction ascending( a, b ) {\n\n\t\t\t\treturn a.time - b.time;\n\n\t\t\t}\n\n\t\t}\n\n\t\tvar position = new THREE.Vector3();\n\t\tvar scale = new THREE.Vector3();\n\t\tvar quaternion = new THREE.Quaternion();\n\n\t\tfunction createKeyframeTracks( animation, tracks ) {\n\n\t\t\tvar keyframes = animation.keyframes;\n\t\t\tvar name = animation.name;\n\n\t\t\tvar times = [];\n\t\t\tvar positionData = [];\n\t\t\tvar quaternionData = [];\n\t\t\tvar scaleData = [];\n\n\t\t\tfor ( var i = 0, l = keyframes.length; i < l; i ++ ) {\n\n\t\t\t\tvar keyframe = keyframes[ i ];\n\n\t\t\t\tvar time = keyframe.time;\n\t\t\t\tvar value = keyframe.value;\n\n\t\t\t\tmatrix.fromArray( value ).transpose();\n\t\t\t\tmatrix.decompose( position, quaternion, scale );\n\n\t\t\t\ttimes.push( time );\n\t\t\t\tpositionData.push( position.x, position.y, position.z );\n\t\t\t\tquaternionData.push( quaternion.x, quaternion.y, quaternion.z, quaternion.w );\n\t\t\t\tscaleData.push( scale.x, scale.y, scale.z );\n\n\t\t\t}\n\n\t\t\tif ( positionData.length > 0 ) tracks.push( new THREE.VectorKeyframeTrack( name + '.position', times, positionData ) );\n\t\t\tif ( quaternionData.length > 0 ) tracks.push( new THREE.QuaternionKeyframeTrack( name + '.quaternion', times, quaternionData ) );\n\t\t\tif ( scaleData.length > 0 ) tracks.push( new THREE.VectorKeyframeTrack( name + '.scale', times, scaleData ) );\n\n\t\t\treturn tracks;\n\n\t\t}\n\n\t\tfunction transformAnimationData( keyframes, property, defaultValue ) {\n\n\t\t\tvar keyframe;\n\n\t\t\tvar empty = true;\n\t\t\tvar i, l;\n\n\t\t\t// check, if values of a property are missing in our keyframes\n\n\t\t\tfor ( i = 0, l = keyframes.length; i < l; i ++ ) {\n\n\t\t\t\tkeyframe = keyframes[ i ];\n\n\t\t\t\tif ( keyframe.value[ property ] === undefined ) {\n\n\t\t\t\t\tkeyframe.value[ property ] = null; // mark as missing\n\n\t\t\t\t} else {\n\n\t\t\t\t\tempty = false;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( empty === true ) {\n\n\t\t\t\t// no values at all, so we set a default value\n\n\t\t\t\tfor ( i = 0, l = keyframes.length; i < l; i ++ ) {\n\n\t\t\t\t\tkeyframe = keyframes[ i ];\n\n\t\t\t\t\tkeyframe.value[ property ] = defaultValue;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\t// filling gaps\n\n\t\t\t\tcreateMissingKeyframes( keyframes, property );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction createMissingKeyframes( keyframes, property ) {\n\n\t\t\tvar prev, next;\n\n\t\t\tfor ( var i = 0, l = keyframes.length; i < l; i ++ ) {\n\n\t\t\t\tvar keyframe = keyframes[ i ];\n\n\t\t\t\tif ( keyframe.value[ property ] === null ) {\n\n\t\t\t\t\tprev = getPrev( keyframes, i, property );\n\t\t\t\t\tnext = getNext( keyframes, i, property );\n\n\t\t\t\t\tif ( prev === null ) {\n\n\t\t\t\t\t\tkeyframe.value[ property ] = next.value[ property ];\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( next === null ) {\n\n\t\t\t\t\t\tkeyframe.value[ property ] = prev.value[ property ];\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tinterpolate( keyframe, prev, next, property );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction getPrev( keyframes, i, property ) {\n\n\t\t\twhile ( i >= 0 ) {\n\n\t\t\t\tvar keyframe = keyframes[ i ];\n\n\t\t\t\tif ( keyframe.value[ property ] !== null ) return keyframe;\n\n\t\t\t\ti --;\n\n\t\t\t}\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tfunction getNext( keyframes, i, property ) {\n\n\t\t\twhile ( i < keyframes.length ) {\n\n\t\t\t\tvar keyframe = keyframes[ i ];\n\n\t\t\t\tif ( keyframe.value[ property ] !== null ) return keyframe;\n\n\t\t\t\ti ++;\n\n\t\t\t}\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tfunction interpolate( key, prev, next, property ) {\n\n\t\t\tif ( ( next.time - prev.time ) === 0 ) {\n\n\t\t\t\tkey.value[ property ] = prev.value[ property ];\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\tkey.value[ property ] = ( ( key.time - prev.time ) * ( next.value[ property ] - prev.value[ property ] ) / ( next.time - prev.time ) ) + prev.value[ property ];\n\n\t\t}\n\n\t\t// animation clips\n\n\t\tfunction parseAnimationClip( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tname: xml.getAttribute( 'id' ) || 'default',\n\t\t\t\tstart: parseFloat( xml.getAttribute( 'start' ) || 0 ),\n\t\t\t\tend: parseFloat( xml.getAttribute( 'end' ) || 0 ),\n\t\t\t\tanimations: []\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'instance_animation':\n\t\t\t\t\t\tdata.animations.push( parseId( child.getAttribute( 'url' ) ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.clips[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction buildAnimationClip( data ) {\n\n\t\t\tvar tracks = [];\n\n\t\t\tvar name = data.name;\n\t\t\tvar duration = ( data.end - data.start ) || - 1;\n\t\t\tvar animations = data.animations;\n\n\t\t\tfor ( var i = 0, il = animations.length; i < il; i ++ ) {\n\n\t\t\t\tvar animationTracks = getAnimation( animations[ i ] );\n\n\t\t\t\tfor ( var j = 0, jl = animationTracks.length; j < jl; j ++ ) {\n\n\t\t\t\t\ttracks.push( animationTracks[ j ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn new THREE.AnimationClip( name, duration, tracks );\n\n\t\t}\n\n\t\tfunction getAnimationClip( id ) {\n\n\t\t\treturn getBuild( library.clips[ id ], buildAnimationClip );\n\n\t\t}\n\n\t\t// controller\n\n\t\tfunction parseController( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'skin':\n\t\t\t\t\t\t// there is exactly one skin per controller\n\t\t\t\t\t\tdata.id = parseId( child.getAttribute( 'source' ) );\n\t\t\t\t\t\tdata.skin = parseSkin( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'morph':\n\t\t\t\t\t\tdata.id = parseId( child.getAttribute( 'source' ) );\n\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Morph target animation not supported yet.' );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.controllers[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction parseSkin( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tsources: {}\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'bind_shape_matrix':\n\t\t\t\t\t\tdata.bindShapeMatrix = parseFloats( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'source':\n\t\t\t\t\t\tvar id = child.getAttribute( 'id' );\n\t\t\t\t\t\tdata.sources[ id ] = parseSource( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'joints':\n\t\t\t\t\t\tdata.joints = parseJoints( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'vertex_weights':\n\t\t\t\t\t\tdata.vertexWeights = parseVertexWeights( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseJoints( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tinputs: {}\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'input':\n\t\t\t\t\t\tvar semantic = child.getAttribute( 'semantic' );\n\t\t\t\t\t\tvar id = parseId( child.getAttribute( 'source' ) );\n\t\t\t\t\t\tdata.inputs[ semantic ] = id;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseVertexWeights( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tinputs: {}\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'input':\n\t\t\t\t\t\tvar semantic = child.getAttribute( 'semantic' );\n\t\t\t\t\t\tvar id = parseId( child.getAttribute( 'source' ) );\n\t\t\t\t\t\tvar offset = parseInt( child.getAttribute( 'offset' ) );\n\t\t\t\t\t\tdata.inputs[ semantic ] = { id: id, offset: offset };\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'vcount':\n\t\t\t\t\t\tdata.vcount = parseInts( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'v':\n\t\t\t\t\t\tdata.v = parseInts( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildController( data ) {\n\n\t\t\tvar build = {\n\t\t\t\tid: data.id\n\t\t\t};\n\n\t\t\tvar geometry = library.geometries[ build.id ];\n\n\t\t\tif ( data.skin !== undefined ) {\n\n\t\t\t\tbuild.skin = buildSkin( data.skin );\n\n\t\t\t\t// we enhance the 'sources' property of the corresponding geometry with our skin data\n\n\t\t\t\tgeometry.sources.skinIndices = build.skin.indices;\n\t\t\t\tgeometry.sources.skinWeights = build.skin.weights;\n\n\t\t\t}\n\n\t\t\treturn build;\n\n\t\t}\n\n\t\tfunction buildSkin( data ) {\n\n\t\t\tvar BONE_LIMIT = 4;\n\n\t\t\tvar build = {\n\t\t\t\tjoints: [], // this must be an array to preserve the joint order\n\t\t\t\tindices: {\n\t\t\t\t\tarray: [],\n\t\t\t\t\tstride: BONE_LIMIT\n\t\t\t\t},\n\t\t\t\tweights: {\n\t\t\t\t\tarray: [],\n\t\t\t\t\tstride: BONE_LIMIT\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tvar sources = data.sources;\n\t\t\tvar vertexWeights = data.vertexWeights;\n\n\t\t\tvar vcount = vertexWeights.vcount;\n\t\t\tvar v = vertexWeights.v;\n\t\t\tvar jointOffset = vertexWeights.inputs.JOINT.offset;\n\t\t\tvar weightOffset = vertexWeights.inputs.WEIGHT.offset;\n\n\t\t\tvar jointSource = data.sources[ data.joints.inputs.JOINT ];\n\t\t\tvar inverseSource = data.sources[ data.joints.inputs.INV_BIND_MATRIX ];\n\n\t\t\tvar weights = sources[ vertexWeights.inputs.WEIGHT.id ].array;\n\t\t\tvar stride = 0;\n\n\t\t\tvar i, j, l;\n\n\t\t\t// procces skin data for each vertex\n\n\t\t\tfor ( i = 0, l = vcount.length; i < l; i ++ ) {\n\n\t\t\t\tvar jointCount = vcount[ i ]; // this is the amount of joints that affect a single vertex\n\t\t\t\tvar vertexSkinData = [];\n\n\t\t\t\tfor ( j = 0; j < jointCount; j ++ ) {\n\n\t\t\t\t\tvar skinIndex = v[ stride + jointOffset ];\n\t\t\t\t\tvar weightId = v[ stride + weightOffset ];\n\t\t\t\t\tvar skinWeight = weights[ weightId ];\n\n\t\t\t\t\tvertexSkinData.push( { index: skinIndex, weight: skinWeight } );\n\n\t\t\t\t\tstride += 2;\n\n\t\t\t\t}\n\n\t\t\t\t// we sort the joints in descending order based on the weights.\n\t\t\t\t// this ensures, we only procced the most important joints of the vertex\n\n\t\t\t\tvertexSkinData.sort( descending );\n\n\t\t\t\t// now we provide for each vertex a set of four index and weight values.\n\t\t\t\t// the order of the skin data matches the order of vertices\n\n\t\t\t\tfor ( j = 0; j < BONE_LIMIT; j ++ ) {\n\n\t\t\t\t\tvar d = vertexSkinData[ j ];\n\n\t\t\t\t\tif ( d !== undefined ) {\n\n\t\t\t\t\t\tbuild.indices.array.push( d.index );\n\t\t\t\t\t\tbuild.weights.array.push( d.weight );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tbuild.indices.array.push( 0 );\n\t\t\t\t\t\tbuild.weights.array.push( 0 );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// setup bind matrix\n\n\t\t\tif ( data.bindShapeMatrix ) {\n\n\t\t\t\tbuild.bindMatrix = new THREE.Matrix4().fromArray( data.bindShapeMatrix ).transpose(); \n\n\t\t\t} else {\n\n\t\t\t\tbuild.bindMatrix = new THREE.Matrix4().transpose(); \n\n\t\t\t}\n\n\t\t\t// process bones and inverse bind matrix data\n\n\t\t\tfor ( i = 0, l = jointSource.array.length; i < l; i ++ ) {\n\n\t\t\t\tvar name = jointSource.array[ i ];\n\t\t\t\tvar boneInverse = new THREE.Matrix4().fromArray( inverseSource.array, i * inverseSource.stride ).transpose();\n\n\t\t\t\tbuild.joints.push( { name: name, boneInverse: boneInverse } );\n\n\t\t\t}\n\n\t\t\treturn build;\n\n\t\t\t// array sort function\n\n\t\t\tfunction descending( a, b ) {\n\n\t\t\t\treturn b.weight - a.weight;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction getController( id ) {\n\n\t\t\treturn getBuild( library.controllers[ id ], buildController );\n\n\t\t}\n\n\t\t// image\n\n\t\tfunction parseImage( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tinit_from: getElementsByTagName( xml, 'init_from' )[ 0 ].textContent\n\t\t\t};\n\n\t\t\tlibrary.images[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction buildImage( data ) {\n\n\t\t\tif ( data.build !== undefined ) return data.build;\n\n\t\t\treturn data.init_from;\n\n\t\t}\n\n\t\tfunction getImage( id ) {\n\n\t\t\tvar data = library.images[ id ];\n\n\t\t\tif ( data !== undefined ) {\n\n\t\t\t\treturn getBuild( data, buildImage );\n\n\t\t\t}\n\n\t\t\tconsole.warn( 'THREE.ColladaLoader: Couldn\\'t find image with ID:', id );\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// effect\n\n\t\tfunction parseEffect( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'profile_COMMON':\n\t\t\t\t\t\tdata.profile = parseEffectProfileCOMMON( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.effects[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction parseEffectProfileCOMMON( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tsurfaces: {},\n\t\t\t\tsamplers: {}\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'newparam':\n\t\t\t\t\t\tparseEffectNewparam( child, data );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'technique':\n\t\t\t\t\t\tdata.technique = parseEffectTechnique( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'extra':\n\t\t\t\t\t\tdata.extra = parseEffectExtra( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectNewparam( xml, data ) {\n\n\t\t\tvar sid = xml.getAttribute( 'sid' );\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'surface':\n\t\t\t\t\t\tdata.surfaces[ sid ] = parseEffectSurface( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'sampler2D':\n\t\t\t\t\t\tdata.samplers[ sid ] = parseEffectSampler( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parseEffectSurface( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'init_from':\n\t\t\t\t\t\tdata.init_from = child.textContent;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectSampler( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'source':\n\t\t\t\t\t\tdata.source = child.textContent;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectTechnique( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'constant':\n\t\t\t\t\tcase 'lambert':\n\t\t\t\t\tcase 'blinn':\n\t\t\t\t\tcase 'phong':\n\t\t\t\t\t\tdata.type = child.nodeName;\n\t\t\t\t\t\tdata.parameters = parseEffectParameters( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectParameters( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'emission':\n\t\t\t\t\tcase 'diffuse':\n\t\t\t\t\tcase 'specular':\n\t\t\t\t\tcase 'shininess':\n\t\t\t\t\tcase 'transparency':\n\t\t\t\t\t\tdata[ child.nodeName ] = parseEffectParameter( child );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'transparent':\n\t\t\t\t\t\tdata[ child.nodeName ] = {\n\t\t\t\t\t\t\topaque: child.getAttribute( 'opaque' ),\n\t\t\t\t\t\t\tdata: parseEffectParameter( child )\n\t\t\t\t\t\t};\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectParameter( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'color':\n\t\t\t\t\t\tdata[ child.nodeName ] = parseFloats( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'float':\n\t\t\t\t\t\tdata[ child.nodeName ] = parseFloat( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'texture':\n\t\t\t\t\t\tdata[ child.nodeName ] = { id: child.getAttribute( 'texture' ), extra: parseEffectParameterTexture( child ) };\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectParameterTexture( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\ttechnique: {}\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'extra':\n\t\t\t\t\t\tparseEffectParameterTextureExtra( child, data );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectParameterTextureExtra( xml, data ) {\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'technique':\n\t\t\t\t\t\tparseEffectParameterTextureExtraTechnique( child, data );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parseEffectParameterTextureExtraTechnique( xml, data ) {\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'repeatU':\n\t\t\t\t\tcase 'repeatV':\n\t\t\t\t\tcase 'offsetU':\n\t\t\t\t\tcase 'offsetV':\n\t\t\t\t\t\tdata.technique[ child.nodeName ] = parseFloat( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'wrapU':\n\t\t\t\t\tcase 'wrapV':\n\n\t\t\t\t\t\t// some files have values for wrapU/wrapV which become NaN via parseInt\n\n\t\t\t\t\t\tif ( child.textContent.toUpperCase() === 'TRUE' ) {\n\n\t\t\t\t\t\t\tdata.technique[ child.nodeName ] = 1;\n\n\t\t\t\t\t\t} else if ( child.textContent.toUpperCase() === 'FALSE' ) {\n\n\t\t\t\t\t\t\tdata.technique[ child.nodeName ] = 0;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tdata.technique[ child.nodeName ] = parseInt( child.textContent );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parseEffectExtra( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'technique':\n\t\t\t\t\t\tdata.technique = parseEffectExtraTechnique( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectExtraTechnique( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'double_sided':\n\t\t\t\t\t\tdata[ child.nodeName ] = parseInt( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildEffect( data ) {\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction getEffect( id ) {\n\n\t\t\treturn getBuild( library.effects[ id ], buildEffect );\n\n\t\t}\n\n\t\t// material\n\n\t\tfunction parseMaterial( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tname: xml.getAttribute( 'name' )\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'instance_effect':\n\t\t\t\t\t\tdata.url = parseId( child.getAttribute( 'url' ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.materials[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction buildMaterial( data ) {\n\n\t\t\tvar effect = getEffect( data.url );\n\t\t\tvar technique = effect.profile.technique;\n\t\t\tvar extra = effect.profile.extra;\n\n\t\t\tvar material;\n\n\t\t\tswitch ( technique.type ) {\n\n\t\t\t\tcase 'phong':\n\t\t\t\tcase 'blinn':\n\t\t\t\t\tmaterial = new THREE.MeshPhongMaterial();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'lambert':\n\t\t\t\t\tmaterial = new THREE.MeshLambertMaterial();\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tmaterial = new THREE.MeshBasicMaterial();\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tmaterial.name = data.name;\n\n\t\t\tfunction getTexture( textureObject ) {\n\n\t\t\t\tvar sampler = effect.profile.samplers[ textureObject.id ];\n\t\t\t\tvar image = null;\n\n\t\t\t\t// get image\n\n\t\t\t\tif ( sampler !== undefined ) {\n\n\t\t\t\t\tvar surface = effect.profile.surfaces[ sampler.source ];\n\t\t\t\t\timage = getImage( surface.init_from );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530).' );\n\t\t\t\t\timage = getImage( textureObject.id );\n\n\t\t\t\t}\n\n\t\t\t\t// create texture if image is avaiable\n\n\t\t\t\tif ( image !== null ) {\n\n\t\t\t\t\tvar texture = textureLoader.load( image );\n\n\t\t\t\t\tvar extra = textureObject.extra;\n\n\t\t\t\t\tif ( extra !== undefined && extra.technique !== undefined && isEmpty( extra.technique ) === false ) {\n\n\t\t\t\t\t\tvar technique = extra.technique;\n\n\t\t\t\t\t\ttexture.wrapS = technique.wrapU ? THREE.RepeatWrapping : THREE.ClampToEdgeWrapping;\n\t\t\t\t\t\ttexture.wrapT = technique.wrapV ? THREE.RepeatWrapping : THREE.ClampToEdgeWrapping;\n\n\t\t\t\t\t\ttexture.offset.set( technique.offsetU || 0, technique.offsetV || 0 );\n\t\t\t\t\t\ttexture.repeat.set( technique.repeatU || 1, technique.repeatV || 1 );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\ttexture.wrapS = THREE.RepeatWrapping;\n\t\t\t\t\t\ttexture.wrapT = THREE.RepeatWrapping;\n\n\t\t\t\t\t}\n\n\t\t\t\t\treturn texture;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Couldn\\'t create texture with ID:', textureObject.id );\n\n\t\t\t\t\treturn null;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tvar parameters = technique.parameters;\n\n\t\t\tfor ( var key in parameters ) {\n\n\t\t\t\tvar parameter = parameters[ key ];\n\n\t\t\t\tswitch ( key ) {\n\n\t\t\t\t\tcase 'diffuse':\n\t\t\t\t\t\tif ( parameter.color ) material.color.fromArray( parameter.color );\n\t\t\t\t\t\tif ( parameter.texture ) material.map = getTexture( parameter.texture );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'specular':\n\t\t\t\t\t\tif ( parameter.color && material.specular ) material.specular.fromArray( parameter.color );\n\t\t\t\t\t\tif ( parameter.texture ) material.specularMap = getTexture( parameter.texture );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'shininess':\n\t\t\t\t\t\tif ( parameter.float && material.shininess ) material.shininess = parameter.float;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'emission':\n\t\t\t\t\t\tif ( parameter.color && material.emissive ) material.emissive.fromArray( parameter.color );\n\t\t\t\t\t\tif ( parameter.texture ) material.emissiveMap = getTexture( parameter.texture );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\tvar transparent = parameters[ 'transparent' ];\n\t\t\tvar transparency = parameters[ 'transparency' ];\n\n\t\t\t// <transparency> does not exist but <transparent>\n\n\t\t\tif ( transparency === undefined && transparent ) {\n\n\t\t\t\ttransparency = {\n\t\t\t\t\tfloat: 1\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t\t// <transparent> does not exist but <transparency>\n\n\t\t\tif ( transparent === undefined && transparency ) {\n\n\t\t\t\ttransparent = {\n\t\t\t\t\topaque: 'A_ONE',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tcolor: [ 1, 1, 1, 1 ]\n\t\t\t\t\t} };\n\n\t\t\t}\n\n\t\t\tif ( transparent && transparency ) {\n\n\t\t\t\t// handle case if a texture exists but no color\n\n\t\t\t\tif ( transparent.data.texture ) {\n\n\t\t\t\t\t// we do not set an alpha map (see #13792)\n\n\t\t\t\t\tmaterial.transparent = true;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tvar color = transparent.data.color;\n\n\t\t\t\t\tswitch ( transparent.opaque ) {\n\n\t\t\t\t\t\tcase 'A_ONE':\n\t\t\t\t\t\t\tmaterial.opacity = color[ 3 ] * transparency.float;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'RGB_ZERO':\n\t\t\t\t\t\t\tmaterial.opacity = 1 - ( color[ 0 ] * transparency.float );\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'A_ZERO':\n\t\t\t\t\t\t\tmaterial.opacity = 1 - ( color[ 3 ] * transparency.float );\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'RGB_ONE':\n\t\t\t\t\t\t\tmaterial.opacity = color[ 0 ] * transparency.float;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Invalid opaque type \"%s\" of transparent tag.', transparent.opaque );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( material.opacity < 1 ) material.transparent = true;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\tif ( extra !== undefined && extra.technique !== undefined && extra.technique.double_sided === 1 ) {\n\n\t\t\t\tmaterial.side = THREE.DoubleSide;\n\n\t\t\t}\n\n\t\t\treturn material;\n\n\t\t}\n\n\t\tfunction getMaterial( id ) {\n\n\t\t\treturn getBuild( library.materials[ id ], buildMaterial );\n\n\t\t}\n\n\t\t// camera\n\n\t\tfunction parseCamera( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tname: xml.getAttribute( 'name' )\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'optics':\n\t\t\t\t\t\tdata.optics = parseCameraOptics( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.cameras[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction parseCameraOptics( xml ) {\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'technique_common':\n\t\t\t\t\t\treturn parseCameraTechnique( child );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn {};\n\n\t\t}\n\n\t\tfunction parseCameraTechnique( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'perspective':\n\t\t\t\t\tcase 'orthographic':\n\n\t\t\t\t\t\tdata.technique = child.nodeName;\n\t\t\t\t\t\tdata.parameters = parseCameraParameters( child );\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseCameraParameters( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'xfov':\n\t\t\t\t\tcase 'yfov':\n\t\t\t\t\tcase 'xmag':\n\t\t\t\t\tcase 'ymag':\n\t\t\t\t\tcase 'znear':\n\t\t\t\t\tcase 'zfar':\n\t\t\t\t\tcase 'aspect_ratio':\n\t\t\t\t\t\tdata[ child.nodeName ] = parseFloat( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildCamera( data ) {\n\n\t\t\tvar camera;\n\n\t\t\tswitch ( data.optics.technique ) {\n\n\t\t\t\tcase 'perspective':\n\t\t\t\t\tcamera = new THREE.PerspectiveCamera(\n\t\t\t\t\t\tdata.optics.parameters.yfov,\n\t\t\t\t\t\tdata.optics.parameters.aspect_ratio,\n\t\t\t\t\t\tdata.optics.parameters.znear,\n\t\t\t\t\t\tdata.optics.parameters.zfar\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'orthographic':\n\t\t\t\t\tvar ymag = data.optics.parameters.ymag;\n\t\t\t\t\tvar xmag = data.optics.parameters.xmag;\n\t\t\t\t\tvar aspectRatio = data.optics.parameters.aspect_ratio;\n\n\t\t\t\t\txmag = ( xmag === undefined ) ? ( ymag * aspectRatio ) : xmag;\n\t\t\t\t\tymag = ( ymag === undefined ) ? ( xmag / aspectRatio ) : ymag;\n\n\t\t\t\t\txmag *= 0.5;\n\t\t\t\t\tymag *= 0.5;\n\n\t\t\t\t\tcamera = new THREE.OrthographicCamera(\n\t\t\t\t\t\t- xmag, xmag, ymag, - ymag, // left, right, top, bottom\n\t\t\t\t\t\tdata.optics.parameters.znear,\n\t\t\t\t\t\tdata.optics.parameters.zfar\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tcamera = new THREE.PerspectiveCamera();\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tcamera.name = data.name;\n\n\t\t\treturn camera;\n\n\t\t}\n\n\t\tfunction getCamera( id ) {\n\n\t\t\tvar data = library.cameras[ id ];\n\n\t\t\tif ( data !== undefined ) {\n\n\t\t\t\treturn getBuild( data, buildCamera );\n\n\t\t\t}\n\n\t\t\tconsole.warn( 'THREE.ColladaLoader: Couldn\\'t find camera with ID:', id );\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// light\n\n\t\tfunction parseLight( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'technique_common':\n\t\t\t\t\t\tdata = parseLightTechnique( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.lights[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction parseLightTechnique( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'directional':\n\t\t\t\t\tcase 'point':\n\t\t\t\t\tcase 'spot':\n\t\t\t\t\tcase 'ambient':\n\n\t\t\t\t\t\tdata.technique = child.nodeName;\n\t\t\t\t\t\tdata.parameters = parseLightParameters( child );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseLightParameters( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'color':\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\n\t\t\t\t\t\tdata.color = new THREE.Color().fromArray( array );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'falloff_angle':\n\t\t\t\t\t\tdata.falloffAngle = parseFloat( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'quadratic_attenuation':\n\t\t\t\t\t\tvar f = parseFloat( child.textContent );\n\t\t\t\t\t\tdata.distance = f ? Math.sqrt( 1 / f ) : 0;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildLight( data ) {\n\n\t\t\tvar light;\n\n\t\t\tswitch ( data.technique ) {\n\n\t\t\t\tcase 'directional':\n\t\t\t\t\tlight = new THREE.DirectionalLight();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'point':\n\t\t\t\t\tlight = new THREE.PointLight();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'spot':\n\t\t\t\t\tlight = new THREE.SpotLight();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'ambient':\n\t\t\t\t\tlight = new THREE.AmbientLight();\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tif ( data.parameters.color ) light.color.copy( data.parameters.color );\n\t\t\tif ( data.parameters.distance ) light.distance = data.parameters.distance;\n\n\t\t\treturn light;\n\n\t\t}\n\n\t\tfunction getLight( id ) {\n\n\t\t\tvar data = library.lights[ id ];\n\n\t\t\tif ( data !== undefined ) {\n\n\t\t\t\treturn getBuild( data, buildLight );\n\n\t\t\t}\n\n\t\t\tconsole.warn( 'THREE.ColladaLoader: Couldn\\'t find light with ID:', id );\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// geometry\n\n\t\tfunction parseGeometry( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tname: xml.getAttribute( 'name' ),\n\t\t\t\tsources: {},\n\t\t\t\tvertices: {},\n\t\t\t\tprimitives: []\n\t\t\t};\n\n\t\t\tvar mesh = getElementsByTagName( xml, 'mesh' )[ 0 ];\n\n\t\t\t// the following tags inside geometry are not supported yet (see https://github.com/mrdoob/three.js/pull/12606): convex_mesh, spline, brep\n\t\t\tif ( mesh === undefined ) return;\n\n\t\t\tfor ( var i = 0; i < mesh.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = mesh.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tvar id = child.getAttribute( 'id' );\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'source':\n\t\t\t\t\t\tdata.sources[ id ] = parseSource( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'vertices':\n\t\t\t\t\t\t// data.sources[ id ] = data.sources[ parseId( getElementsByTagName( child, 'input' )[ 0 ].getAttribute( 'source' ) ) ];\n\t\t\t\t\t\tdata.vertices = parseGeometryVertices( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'polygons':\n\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Unsupported primitive type: ', child.nodeName );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'lines':\n\t\t\t\t\tcase 'linestrips':\n\t\t\t\t\tcase 'polylist':\n\t\t\t\t\tcase 'triangles':\n\t\t\t\t\t\tdata.primitives.push( parseGeometryPrimitive( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.log( child );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.geometries[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction parseSource( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tarray: [],\n\t\t\t\tstride: 3\n\t\t\t};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'float_array':\n\t\t\t\t\t\tdata.array = parseFloats( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'Name_array':\n\t\t\t\t\t\tdata.array = parseStrings( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'technique_common':\n\t\t\t\t\t\tvar accessor = getElementsByTagName( child, 'accessor' )[ 0 ];\n\n\t\t\t\t\t\tif ( accessor !== undefined ) {\n\n\t\t\t\t\t\t\tdata.stride = parseInt( accessor.getAttribute( 'stride' ) );\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseGeometryVertices( xml ) {\n\n\t\t\tvar data = {};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tdata[ child.getAttribute( 'semantic' ) ] = parseId( child.getAttribute( 'source' ) );\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseGeometryPrimitive( xml ) {\n\n\t\t\tvar primitive = {\n\t\t\t\ttype: xml.nodeName,\n\t\t\t\tmaterial: xml.getAttribute( 'material' ),\n\t\t\t\tcount: parseInt( xml.getAttribute( 'count' ) ),\n\t\t\t\tinputs: {},\n\t\t\t\tstride: 0,\n\t\t\t\thasUV: false\n\t\t\t};\n\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'input':\n\t\t\t\t\t\tvar id = parseId( child.getAttribute( 'source' ) );\n\t\t\t\t\t\tvar semantic = child.getAttribute( 'semantic' );\n\t\t\t\t\t\tvar offset = parseInt( child.getAttribute( 'offset' ) );\n\t\t\t\t\t\tprimitive.inputs[ semantic ] = { id: id, offset: offset };\n\t\t\t\t\t\tprimitive.stride = Math.max( primitive.stride, offset + 1 );\n\t\t\t\t\t\tif ( semantic === 'TEXCOORD' ) primitive.hasUV = true;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'vcount':\n\t\t\t\t\t\tprimitive.vcount = parseInts( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'p':\n\t\t\t\t\t\tprimitive.p = parseInts( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn primitive;\n\n\t\t}\n\n\t\tfunction groupPrimitives( primitives ) {\n\n\t\t\tvar build = {};\n\n\t\t\tfor ( var i = 0; i < primitives.length; i ++ ) {\n\n\t\t\t\tvar primitive = primitives[ i ];\n\n\t\t\t\tif ( build[ primitive.type ] === undefined ) build[ primitive.type ] = [];\n\n\t\t\t\tbuild[ primitive.type ].push( primitive );\n\n\t\t\t}\n\n\t\t\treturn build;\n\n\t\t}\n\n\t\tfunction checkUVCoordinates( primitives ) {\n\n\t\t\tvar count = 0;\n\n\t\t\tfor ( var i = 0, l = primitives.length; i < l; i ++ ) {\n\n\t\t\t\tvar primitive = primitives[ i ];\n\n\t\t\t\tif ( primitive.hasUV === true ) {\n\n\t\t\t\t\tcount ++;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( count > 0 && count < primitives.length ) {\n\n\t\t\t\tprimitives.uvsNeedsFix = true;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction buildGeometry( data ) {\n\n\t\t\tvar build = {};\n\n\t\t\tvar sources = data.sources;\n\t\t\tvar vertices = data.vertices;\n\t\t\tvar primitives = data.primitives;\n\n\t\t\tif ( primitives.length === 0 ) return {};\n\n\t\t\t// our goal is to create one buffer geometry for a single type of primitives\n\t\t\t// first, we group all primitives by their type\n\n\t\t\tvar groupedPrimitives = groupPrimitives( primitives );\n\n\t\t\tfor ( var type in groupedPrimitives ) {\n\n\t\t\t\tvar primitiveType = groupedPrimitives[ type ];\n\n\t\t\t\t// second, ensure consistent uv coordinates for each type of primitives (polylist,triangles or lines)\n\n\t\t\t\tcheckUVCoordinates( primitiveType );\n\n\t\t\t\t// third, create a buffer geometry for each type of primitives\n\n\t\t\t\tbuild[ type ] = buildGeometryType( primitiveType, sources, vertices );\n\n\t\t\t}\n\n\t\t\treturn build;\n\n\t\t}\n\n\t\tfunction buildGeometryType( primitives, sources, vertices ) {\n\n\t\t\tvar build = {};\n\n\t\t\tvar position = { array: [], stride: 0 };\n\t\t\tvar normal = { array: [], stride: 0 };\n\t\t\tvar uv = { array: [], stride: 0 };\n\t\t\tvar color = { array: [], stride: 0 };\n\n\t\t\tvar skinIndex = { array: [], stride: 4 };\n\t\t\tvar skinWeight = { array: [], stride: 4 };\n\n\t\t\tvar geometry = new THREE.BufferGeometry();\n\n\t\t\tvar materialKeys = [];\n\n\t\t\tvar start = 0;\n\n\t\t\tfor ( var p = 0; p < primitives.length; p ++ ) {\n\n\t\t\t\tvar primitive = primitives[ p ];\n\t\t\t\tvar inputs = primitive.inputs;\n\n\t\t\t\t// groups\n\n\t\t\t\tvar count = 0;\n\n\t\t\t\tswitch ( primitive.type ) {\n\n\t\t\t\t\tcase 'lines':\n\t\t\t\t\tcase 'linestrips':\n\t\t\t\t\t\tcount = primitive.count * 2;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'triangles':\n\t\t\t\t\t\tcount = primitive.count * 3;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'polylist':\n\n\t\t\t\t\t\tfor ( var g = 0; g < primitive.count; g ++ ) {\n\n\t\t\t\t\t\t\tvar vc = primitive.vcount[ g ];\n\n\t\t\t\t\t\t\tswitch ( vc ) {\n\n\t\t\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\t\t\tcount += 3; // single triangle\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\t\t\tcount += 6; // quad, subdivided into two triangles\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\tcount += ( vc - 2 ) * 3; // polylist with more than four vertices\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Unknow primitive type:', primitive.type );\n\n\t\t\t\t}\n\n\t\t\t\tgeometry.addGroup( start, count, p );\n\t\t\t\tstart += count;\n\n\t\t\t\t// material\n\n\t\t\t\tif ( primitive.material ) {\n\n\t\t\t\t\tmaterialKeys.push( primitive.material );\n\n\t\t\t\t}\n\n\t\t\t\t// geometry data\n\n\t\t\t\tfor ( var name in inputs ) {\n\n\t\t\t\t\tvar input = inputs[ name ];\n\n\t\t\t\t\tswitch ( name )\t{\n\n\t\t\t\t\t\tcase 'VERTEX':\n\t\t\t\t\t\t\tfor ( var key in vertices ) {\n\n\t\t\t\t\t\t\t\tvar id = vertices[ key ];\n\n\t\t\t\t\t\t\t\tswitch ( key ) {\n\n\t\t\t\t\t\t\t\t\tcase 'POSITION':\n\t\t\t\t\t\t\t\t\t\tvar prevLength = position.array.length;\n\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ id ], input.offset, position.array );\n\t\t\t\t\t\t\t\t\t\tposition.stride = sources[ id ].stride;\n\n\t\t\t\t\t\t\t\t\t\tif ( sources.skinWeights && sources.skinIndices ) {\n\n\t\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources.skinIndices, input.offset, skinIndex.array );\n\t\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources.skinWeights, input.offset, skinWeight.array );\n\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t// see #3803\n\n\t\t\t\t\t\t\t\t\t\tif ( primitive.hasUV === false && primitives.uvsNeedsFix === true ) {\n\n\t\t\t\t\t\t\t\t\t\t\tvar count = ( position.array.length - prevLength ) / position.stride;\n\n\t\t\t\t\t\t\t\t\t\t\tfor ( var i = 0; i < count; i ++ ) {\n\n\t\t\t\t\t\t\t\t\t\t\t\t// fill missing uv coordinates\n\n\t\t\t\t\t\t\t\t\t\t\t\tuv.array.push( 0, 0 );\n\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase 'NORMAL':\n\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ id ], input.offset, normal.array );\n\t\t\t\t\t\t\t\t\t\tnormal.stride = sources[ id ].stride;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase 'COLOR':\n\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ id ], input.offset, color.array );\n\t\t\t\t\t\t\t\t\t\tcolor.stride = sources[ id ].stride;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase 'TEXCOORD':\n\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ id ], input.offset, uv.array );\n\t\t\t\t\t\t\t\t\t\tuv.stride = sources[ id ].stride;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Semantic \"%s\" not handled in geometry build process.', key );\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'NORMAL':\n\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ input.id ], input.offset, normal.array );\n\t\t\t\t\t\t\tnormal.stride = sources[ input.id ].stride;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'COLOR':\n\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ input.id ], input.offset, color.array );\n\t\t\t\t\t\t\tcolor.stride = sources[ input.id ].stride;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'TEXCOORD':\n\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ input.id ], input.offset, uv.array );\n\t\t\t\t\t\t\tuv.stride = sources[ input.id ].stride;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// build geometry\n\n\t\t\tif ( position.array.length > 0 ) geometry.addAttribute( 'position', new THREE.Float32BufferAttribute( position.array, position.stride ) );\n\t\t\tif ( normal.array.length > 0 ) geometry.addAttribute( 'normal', new THREE.Float32BufferAttribute( normal.array, normal.stride ) );\n\t\t\tif ( color.array.length > 0 ) geometry.addAttribute( 'color', new THREE.Float32BufferAttribute( color.array, color.stride ) );\n\t\t\tif ( uv.array.length > 0 ) geometry.addAttribute( 'uv', new THREE.Float32BufferAttribute( uv.array, uv.stride ) );\n\n\t\t\tif ( skinIndex.array.length > 0 ) geometry.addAttribute( 'skinIndex', new THREE.Float32BufferAttribute( skinIndex.array, skinIndex.stride ) );\n\t\t\tif ( skinWeight.array.length > 0 ) geometry.addAttribute( 'skinWeight', new THREE.Float32BufferAttribute( skinWeight.array, skinWeight.stride ) );\n\n\t\t\tbuild.data = geometry;\n\t\t\tbuild.type = primitives[ 0 ].type;\n\t\t\tbuild.materialKeys = materialKeys;\n\n\t\t\treturn build;\n\n\t\t}\n\n\t\tfunction buildGeometryData( primitive, source, offset, array ) {\n\n\t\t\tvar indices = primitive.p;\n\t\t\tvar stride = primitive.stride;\n\t\t\tvar vcount = primitive.vcount;\n\n\t\t\tfunction pushVector( i ) {\n\n\t\t\t\tvar index = indices[ i + offset ] * sourceStride;\n\t\t\t\tvar length = index + sourceStride;\n\n\t\t\t\tfor ( ; index < length; index ++ ) {\n\n\t\t\t\t\tarray.push( sourceArray[ index ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tvar sourceArray = source.array;\n\t\t\tvar sourceStride = source.stride;\n\n\t\t\tif ( primitive.vcount !== undefined ) {\n\n\t\t\t\tvar index = 0;\n\n\t\t\t\tfor ( var i = 0, l = vcount.length; i < l; i ++ ) {\n\n\t\t\t\t\tvar count = vcount[ i ];\n\n\t\t\t\t\tif ( count === 4 ) {\n\n\t\t\t\t\t\tvar a = index + stride * 0;\n\t\t\t\t\t\tvar b = index + stride * 1;\n\t\t\t\t\t\tvar c = index + stride * 2;\n\t\t\t\t\t\tvar d = index + stride * 3;\n\n\t\t\t\t\t\tpushVector( a ); pushVector( b ); pushVector( d );\n\t\t\t\t\t\tpushVector( b ); pushVector( c ); pushVector( d );\n\n\t\t\t\t\t} else if ( count === 3 ) {\n\n\t\t\t\t\t\tvar a = index + stride * 0;\n\t\t\t\t\t\tvar b = index + stride * 1;\n\t\t\t\t\t\tvar c = index + stride * 2;\n\n\t\t\t\t\t\tpushVector( a ); pushVector( b ); pushVector( c );\n\n\t\t\t\t\t} else if ( count > 4 ) {\n\n\t\t\t\t\t\tfor ( var k = 1, kl = ( count - 2 ); k <= kl; k ++ ) {\n\n\t\t\t\t\t\t\tvar a = index + stride * 0;\n\t\t\t\t\t\t\tvar b = index + stride * k;\n\t\t\t\t\t\t\tvar c = index + stride * ( k + 1 );\n\n\t\t\t\t\t\t\tpushVector( a ); pushVector( b ); pushVector( c );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tindex += stride * count;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tfor ( var i = 0, l = indices.length; i < l; i += stride ) {\n\n\t\t\t\t\tpushVector( i );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction getGeometry( id ) {\n\n\t\t\treturn getBuild( library.geometries[ id ], buildGeometry );\n\n\t\t}\n\n\t\t// kinematics\n\n\t\tfunction parseKinematicsModel( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tname: xml.getAttribute( 'name' ) || '',\n\t\t\t\tjoints: {},\n\t\t\t\tlinks: []\n\t\t\t};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'technique_common':\n\t\t\t\t\t\tparseKinematicsTechniqueCommon( child, data );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.kinematicsModels[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction buildKinematicsModel( data ) {\n\n\t\t\tif ( data.build !== undefined ) return data.build;\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction getKinematicsModel( id ) {\n\n\t\t\treturn getBuild( library.kinematicsModels[ id ], buildKinematicsModel );\n\n\t\t}\n\n\t\tfunction parseKinematicsTechniqueCommon( xml, data ) {\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'joint':\n\t\t\t\t\t\tdata.joints[ child.getAttribute( 'sid' ) ] = parseKinematicsJoint( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'link':\n\t\t\t\t\t\tdata.links.push( parseKinematicsLink( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parseKinematicsJoint( xml ) {\n\n\t\t\tvar data;\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'prismatic':\n\t\t\t\t\tcase 'revolute':\n\t\t\t\t\t\tdata = parseKinematicsJointParameter( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseKinematicsJointParameter( xml, data ) {\n\n\t\t\tvar data = {\n\t\t\t\tsid: xml.getAttribute( 'sid' ),\n\t\t\t\tname: xml.getAttribute( 'name' ) || '',\n\t\t\t\taxis: new THREE.Vector3(),\n\t\t\t\tlimits: {\n\t\t\t\t\tmin: 0,\n\t\t\t\t\tmax: 0\n\t\t\t\t},\n\t\t\t\ttype: xml.nodeName,\n\t\t\t\tstatic: false,\n\t\t\t\tzeroPosition: 0,\n\t\t\t\tmiddlePosition: 0\n\t\t\t};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'axis':\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\n\t\t\t\t\t\tdata.axis.fromArray( array );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'limits':\n\t\t\t\t\t\tvar max = child.getElementsByTagName( 'max' )[ 0 ];\n\t\t\t\t\t\tvar min = child.getElementsByTagName( 'min' )[ 0 ];\n\n\t\t\t\t\t\tdata.limits.max = parseFloat( max.textContent );\n\t\t\t\t\t\tdata.limits.min = parseFloat( min.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// if min is equal to or greater than max, consider the joint static\n\n\t\t\tif ( data.limits.min >= data.limits.max ) {\n\n\t\t\t\tdata.static = true;\n\n\t\t\t}\n\n\t\t\t// calculate middle position\n\n\t\t\tdata.middlePosition = ( data.limits.min + data.limits.max ) / 2.0;\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseKinematicsLink( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tsid: xml.getAttribute( 'sid' ),\n\t\t\t\tname: xml.getAttribute( 'name' ) || '',\n\t\t\t\tattachments: [],\n\t\t\t\ttransforms: []\n\t\t\t};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'attachment_full':\n\t\t\t\t\t\tdata.attachments.push( parseKinematicsAttachment( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'matrix':\n\t\t\t\t\tcase 'translate':\n\t\t\t\t\tcase 'rotate':\n\t\t\t\t\t\tdata.transforms.push( parseKinematicsTransform( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseKinematicsAttachment( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tjoint: xml.getAttribute( 'joint' ).split( '/' ).pop(),\n\t\t\t\ttransforms: [],\n\t\t\t\tlinks: []\n\t\t\t};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'link':\n\t\t\t\t\t\tdata.links.push( parseKinematicsLink( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'matrix':\n\t\t\t\t\tcase 'translate':\n\t\t\t\t\tcase 'rotate':\n\t\t\t\t\t\tdata.transforms.push( parseKinematicsTransform( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseKinematicsTransform( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\ttype: xml.nodeName\n\t\t\t};\n\n\t\t\tvar array = parseFloats( xml.textContent );\n\n\t\t\tswitch ( data.type ) {\n\n\t\t\t\tcase 'matrix':\n\t\t\t\t\tdata.obj = new THREE.Matrix4();\n\t\t\t\t\tdata.obj.fromArray( array ).transpose();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'translate':\n\t\t\t\t\tdata.obj = new THREE.Vector3();\n\t\t\t\t\tdata.obj.fromArray( array );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'rotate':\n\t\t\t\t\tdata.obj = new THREE.Vector3();\n\t\t\t\t\tdata.obj.fromArray( array );\n\t\t\t\t\tdata.angle = THREE.Math.degToRad( array[ 3 ] );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\t// physics\n\n\t\tfunction parsePhysicsModel( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tname: xml.getAttribute( 'name' ) || '',\n\t\t\t\trigidBodies: {}\n\t\t\t};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'rigid_body':\n\t\t\t\t\t\tdata.rigidBodies[ child.getAttribute( 'name' ) ] = {};\n\t\t\t\t\t\tparsePhysicsRigidBody( child, data.rigidBodies[ child.getAttribute( 'name' ) ] );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.physicsModels[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction parsePhysicsRigidBody( xml, data ) {\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'technique_common':\n\t\t\t\t\t\tparsePhysicsTechniqueCommon( child, data );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parsePhysicsTechniqueCommon( xml, data ) {\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'inertia':\n\t\t\t\t\t\tdata.inertia = parseFloats( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'mass':\n\t\t\t\t\t\tdata.mass = parseFloats( child.textContent )[0];\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// scene\n\n\t\tfunction parseKinematicsScene( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tbindJointAxis: []\n\t\t\t};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'bind_joint_axis':\n\t\t\t\t\t\tdata.bindJointAxis.push( parseKinematicsBindJointAxis( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.kinematicsScenes[ parseId( xml.getAttribute( 'url' ) ) ] = data;\n\n\t\t}\n\n\t\tfunction parseKinematicsBindJointAxis( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\ttarget: xml.getAttribute( 'target' ).split( '/' ).pop()\n\t\t\t};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'axis':\n\t\t\t\t\t\tvar param = child.getElementsByTagName( 'param' )[ 0 ];\n\t\t\t\t\t\tdata.axis = param.textContent;\n\t\t\t\t\t\tvar tmpJointIndex = data.axis.split( 'inst_' ).pop().split( 'axis' )[ 0 ];\n\t\t\t\t\t\tdata.jointIndex = tmpJointIndex.substr( 0, tmpJointIndex.length - 1 );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildKinematicsScene( data ) {\n\n\t\t\tif ( data.build !== undefined ) return data.build;\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction getKinematicsScene( id ) {\n\n\t\t\treturn getBuild( library.kinematicsScenes[ id ], buildKinematicsScene );\n\n\t\t}\n\n\t\tfunction setupKinematics() {\n\n\t\t\tvar kinematicsModelId = Object.keys( library.kinematicsModels )[ 0 ];\n\t\t\tvar kinematicsSceneId = Object.keys( library.kinematicsScenes )[ 0 ];\n\t\t\tvar visualSceneId = Object.keys( library.visualScenes )[ 0 ];\n\n\t\t\tif ( kinematicsModelId === undefined || kinematicsSceneId === undefined ) return;\n\n\t\t\tvar kinematicsModel = getKinematicsModel( kinematicsModelId );\n\t\t\tvar kinematicsScene = getKinematicsScene( kinematicsSceneId );\n\t\t\tvar visualScene = getVisualScene( visualSceneId );\n\n\t\t\tvar bindJointAxis = kinematicsScene.bindJointAxis;\n\t\t\tvar jointMap = {};\n\n\t\t\tfor ( var i = 0, l = bindJointAxis.length; i < l; i ++ ) {\n\n\t\t\t\tvar axis = bindJointAxis[ i ];\n\n\t\t\t\t// the result of the following query is an element of type 'translate', 'rotate','scale' or 'matrix'\n\n\t\t\t\tvar targetElement = collada.querySelector( '[sid=\"' + axis.target + '\"]' );\n\n\t\t\t\tif ( targetElement ) {\n\n\t\t\t\t\t// get the parent of the transfrom element\n\n\t\t\t\t\tvar parentVisualElement = targetElement.parentElement;\n\n\t\t\t\t\t// connect the joint of the kinematics model with the element in the visual scene\n\n\t\t\t\t\tconnect( axis.jointIndex, parentVisualElement );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tfunction connect( jointIndex, visualElement ) {\n\n\t\t\t\tvar visualElementName = visualElement.getAttribute( 'name' );\n\t\t\t\tvar joint = kinematicsModel.joints[ jointIndex ];\n\n\t\t\t\tvisualScene.traverse( function ( object ) {\n\n\t\t\t\t\tif ( object.name === visualElementName ) {\n\n\t\t\t\t\t\tjointMap[ jointIndex ] = {\n\t\t\t\t\t\t\tobject: object,\n\t\t\t\t\t\t\ttransforms: buildTransformList( visualElement ),\n\t\t\t\t\t\t\tjoint: joint,\n\t\t\t\t\t\t\tposition: joint.zeroPosition\n\t\t\t\t\t\t};\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tvar m0 = new THREE.Matrix4();\n\n\t\t\tkinematics = {\n\n\t\t\t\tjoints: kinematicsModel && kinematicsModel.joints,\n\n\t\t\t\tgetJointValue: function ( jointIndex ) {\n\n\t\t\t\t\tvar jointData = jointMap[ jointIndex ];\n\n\t\t\t\t\tif ( jointData ) {\n\n\t\t\t\t\t\treturn jointData.position;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Joint ' + jointIndex + ' doesn\\'t exist.' );\n\n\t\t\t\t\t}\n\n\t\t\t\t},\n\n\t\t\t\tsetJointValue: function ( jointIndex, value ) {\n\n\t\t\t\t\tvar jointData = jointMap[ jointIndex ];\n\n\t\t\t\t\tif ( jointData ) {\n\n\t\t\t\t\t\tvar joint = jointData.joint;\n\n\t\t\t\t\t\tif ( value > joint.limits.max || value < joint.limits.min ) {\n\n\t\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Joint ' + jointIndex + ' value ' + value + ' outside of limits (min: ' + joint.limits.min + ', max: ' + joint.limits.max + ').' );\n\n\t\t\t\t\t\t} else if ( joint.static ) {\n\n\t\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Joint ' + jointIndex + ' is static.' );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tvar object = jointData.object;\n\t\t\t\t\t\t\tvar axis = joint.axis;\n\t\t\t\t\t\t\tvar transforms = jointData.transforms;\n\n\t\t\t\t\t\t\tmatrix.identity();\n\n\t\t\t\t\t\t\t// each update, we have to apply all transforms in the correct order\n\n\t\t\t\t\t\t\tfor ( var i = 0; i < transforms.length; i ++ ) {\n\n\t\t\t\t\t\t\t\tvar transform = transforms[ i ];\n\n\t\t\t\t\t\t\t\t// if there is a connection of the transform node with a joint, apply the joint value\n\n\t\t\t\t\t\t\t\tif ( transform.sid && transform.sid.indexOf( jointIndex ) !== - 1 ) {\n\n\t\t\t\t\t\t\t\t\tswitch ( joint.type ) {\n\n\t\t\t\t\t\t\t\t\t\tcase 'revolute':\n\t\t\t\t\t\t\t\t\t\t\tmatrix.multiply( m0.makeRotationAxis( axis, THREE.Math.degToRad( value ) ) );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 'prismatic':\n\t\t\t\t\t\t\t\t\t\t\tmatrix.multiply( m0.makeTranslation( axis.x * value, axis.y * value, axis.z * value ) );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Unknown joint type: ' + joint.type );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t\tswitch ( transform.type ) {\n\n\t\t\t\t\t\t\t\t\t\tcase 'matrix':\n\t\t\t\t\t\t\t\t\t\t\tmatrix.multiply( transform.obj );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 'translate':\n\t\t\t\t\t\t\t\t\t\t\tmatrix.multiply( m0.makeTranslation( transform.obj.x, transform.obj.y, transform.obj.z ) );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 'scale':\n\t\t\t\t\t\t\t\t\t\t\tmatrix.scale( transform.obj );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 'rotate':\n\t\t\t\t\t\t\t\t\t\t\tmatrix.multiply( m0.makeRotationAxis( transform.obj, transform.angle ) );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tobject.matrix.copy( matrix );\n\t\t\t\t\t\t\tobject.matrix.decompose( object.position, object.quaternion, object.scale );\n\n\t\t\t\t\t\t\tjointMap[ jointIndex ].position = value;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconsole.log( 'THREE.ColladaLoader: ' + jointIndex + ' does not exist.' );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t}\n\n\t\tfunction buildTransformList( node ) {\n\n\t\t\tvar transforms = [];\n\n\t\t\tvar xml = collada.querySelector( '[id=\"' + node.id + '\"]' );\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'matrix':\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\n\t\t\t\t\t\tvar matrix = new THREE.Matrix4().fromArray( array ).transpose();\n\t\t\t\t\t\ttransforms.push( {\n\t\t\t\t\t\t\tsid: child.getAttribute( 'sid' ),\n\t\t\t\t\t\t\ttype: child.nodeName,\n\t\t\t\t\t\t\tobj: matrix\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'translate':\n\t\t\t\t\tcase 'scale':\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\n\t\t\t\t\t\tvar vector = new THREE.Vector3().fromArray( array );\n\t\t\t\t\t\ttransforms.push( {\n\t\t\t\t\t\t\tsid: child.getAttribute( 'sid' ),\n\t\t\t\t\t\t\ttype: child.nodeName,\n\t\t\t\t\t\t\tobj: vector\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'rotate':\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\n\t\t\t\t\t\tvar vector = new THREE.Vector3().fromArray( array );\n\t\t\t\t\t\tvar angle = THREE.Math.degToRad( array[ 3 ] );\n\t\t\t\t\t\ttransforms.push( {\n\t\t\t\t\t\t\tsid: child.getAttribute( 'sid' ),\n\t\t\t\t\t\t\ttype: child.nodeName,\n\t\t\t\t\t\t\tobj: vector,\n\t\t\t\t\t\t\tangle: angle\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn transforms;\n\n\t\t}\n\n\t\t// nodes\n\n\t\tfunction prepareNodes( xml ) {\n\n\t\t\tvar elements = xml.getElementsByTagName( 'node' );\n\n\t\t\t// ensure all node elements have id attributes\n\n\t\t\tfor ( var i = 0; i < elements.length; i ++ ) {\n\n\t\t\t\tvar element = elements[ i ];\n\n\t\t\t\tif ( element.hasAttribute( 'id' ) === false ) {\n\n\t\t\t\t\telement.setAttribute( 'id', generateId() );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tvar matrix = new THREE.Matrix4();\n\t\tvar vector = new THREE.Vector3();\n\n\t\tfunction parseNode( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tname: xml.getAttribute( 'name' ) || '',\n\t\t\t\ttype: xml.getAttribute( 'type' ),\n\t\t\t\tid: xml.getAttribute( 'id' ),\n\t\t\t\tsid: xml.getAttribute( 'sid' ),\n\t\t\t\tmatrix: new THREE.Matrix4(),\n\t\t\t\tnodes: [],\n\t\t\t\tinstanceCameras: [],\n\t\t\t\tinstanceControllers: [],\n\t\t\t\tinstanceLights: [],\n\t\t\t\tinstanceGeometries: [],\n\t\t\t\tinstanceNodes: [],\n\t\t\t\ttransforms: {}\n\t\t\t};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'node':\n\t\t\t\t\t\tdata.nodes.push( child.getAttribute( 'id' ) );\n\t\t\t\t\t\tparseNode( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'instance_camera':\n\t\t\t\t\t\tdata.instanceCameras.push( parseId( child.getAttribute( 'url' ) ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'instance_controller':\n\t\t\t\t\t\tdata.instanceControllers.push( parseNodeInstance( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'instance_light':\n\t\t\t\t\t\tdata.instanceLights.push( parseId( child.getAttribute( 'url' ) ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'instance_geometry':\n\t\t\t\t\t\tdata.instanceGeometries.push( parseNodeInstance( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'instance_node':\n\t\t\t\t\t\tdata.instanceNodes.push( parseId( child.getAttribute( 'url' ) ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'matrix':\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\n\t\t\t\t\t\tdata.matrix.multiply( matrix.fromArray( array ).transpose() );\n\t\t\t\t\t\tdata.transforms[ child.getAttribute( 'sid' ) ] = child.nodeName;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'translate':\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\n\t\t\t\t\t\tvector.fromArray( array );\n\t\t\t\t\t\tdata.matrix.multiply( matrix.makeTranslation( vector.x, vector.y, vector.z ) );\n\t\t\t\t\t\tdata.transforms[ child.getAttribute( 'sid' ) ] = child.nodeName;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'rotate':\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\n\t\t\t\t\t\tvar angle = THREE.Math.degToRad( array[ 3 ] );\n\t\t\t\t\t\tdata.matrix.multiply( matrix.makeRotationAxis( vector.fromArray( array ), angle ) );\n\t\t\t\t\t\tdata.transforms[ child.getAttribute( 'sid' ) ] = child.nodeName;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'scale':\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\n\t\t\t\t\t\tdata.matrix.scale( vector.fromArray( array ) );\n\t\t\t\t\t\tdata.transforms[ child.getAttribute( 'sid' ) ] = child.nodeName;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'extra':\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.log( child );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.nodes[ data.id ] = data;\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseNodeInstance( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tid: parseId( xml.getAttribute( 'url' ) ),\n\t\t\t\tmaterials: {},\n\t\t\t\tskeletons: []\n\t\t\t};\n\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = xml.childNodes[ i ];\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'bind_material':\n\t\t\t\t\t\tvar instances = child.getElementsByTagName( 'instance_material' );\n\n\t\t\t\t\t\tfor ( var j = 0; j < instances.length; j ++ ) {\n\n\t\t\t\t\t\t\tvar instance = instances[ j ];\n\t\t\t\t\t\t\tvar symbol = instance.getAttribute( 'symbol' );\n\t\t\t\t\t\t\tvar target = instance.getAttribute( 'target' );\n\n\t\t\t\t\t\t\tdata.materials[ symbol ] = parseId( target );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'skeleton':\n\t\t\t\t\t\tdata.skeletons.push( parseId( child.textContent ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildSkeleton( skeletons, joints ) {\n\n\t\t\tvar boneData = [];\n\t\t\tvar sortedBoneData = [];\n\n\t\t\tvar i, j, data;\n\n\t\t\t// a skeleton can have multiple root bones. collada expresses this\n\t\t\t// situtation with multiple \"skeleton\" tags per controller instance\n\n\t\t\tfor ( i = 0; i < skeletons.length; i ++ ) {\n\n\t\t\t\tvar skeleton = skeletons[ i ];\n\n\t\t\t\tvar root;\n\n\t\t\t\tif ( hasNode( skeleton ) ) {\n\n\t\t\t\t\troot = getNode( skeleton );\n\t\t\t\t\tbuildBoneHierarchy( root, joints, boneData );\n\n\t\t\t\t} else if ( hasVisualScene( skeleton ) ) {\n\n\t\t\t\t\t// handle case where the skeleton refers to the visual scene (#13335)\n\n\t\t\t\t\tvar visualScene = library.visualScenes[ skeleton ];\n\t\t\t\t\tvar children = visualScene.children;\n\n\t\t\t\t\tfor ( var j = 0; j < children.length; j ++ ) {\n\n\t\t\t\t\t\tvar child = children[ j ];\n\n\t\t\t\t\t\tif ( child.type === 'JOINT' ) {\n\n\t\t\t\t\t\t\tvar root = getNode( child.id );\n\t\t\t\t\t\t\tbuildBoneHierarchy( root, joints, boneData );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.error( 'THREE.ColladaLoader: Unable to find root bone of skeleton with ID:', skeleton );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// sort bone data (the order is defined in the corresponding controller)\n\n\t\t\tfor ( i = 0; i < joints.length; i ++ ) {\n\n\t\t\t\tfor ( j = 0; j < boneData.length; j ++ ) {\n\n\t\t\t\t\tdata = boneData[ j ];\n\n\t\t\t\t\tif ( data.bone.name === joints[ i ].name ) {\n\n\t\t\t\t\t\tsortedBoneData[ i ] = data;\n\t\t\t\t\t\tdata.processed = true;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// add unprocessed bone data at the end of the list\n\n\t\t\tfor ( i = 0; i < boneData.length; i ++ ) {\n\n\t\t\t\tdata = boneData[ i ];\n\n\t\t\t\tif ( data.processed === false ) {\n\n\t\t\t\t\tsortedBoneData.push( data );\n\t\t\t\t\tdata.processed = true;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// setup arrays for skeleton creation\n\n\t\t\tvar bones = [];\n\t\t\tvar boneInverses = [];\n\n\t\t\tfor ( i = 0; i < sortedBoneData.length; i ++ ) {\n\n\t\t\t\tdata = sortedBoneData[ i ];\n\n\t\t\t\tbones.push( data.bone );\n\t\t\t\tboneInverses.push( data.boneInverse );\n\n\t\t\t}\n\n\t\t\treturn new THREE.Skeleton( bones, boneInverses );\n\n\t\t}\n\n\t\tfunction buildBoneHierarchy( root, joints, boneData ) {\n\n\t\t\t// setup bone data from visual scene\n\n\t\t\troot.traverse( function ( object ) {\n\n\t\t\t\tif ( object.isBone === true ) {\n\n\t\t\t\t\tvar boneInverse;\n\n\t\t\t\t\t// retrieve the boneInverse from the controller data\n\n\t\t\t\t\tfor ( var i = 0; i < joints.length; i ++ ) {\n\n\t\t\t\t\t\tvar joint = joints[ i ];\n\n\t\t\t\t\t\tif ( joint.name === object.name ) {\n\n\t\t\t\t\t\t\tboneInverse = joint.boneInverse;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( boneInverse === undefined ) {\n\n\t\t\t\t\t\t// Unfortunately, there can be joints in the visual scene that are not part of the\n\t\t\t\t\t\t// corresponding controller. In this case, we have to create a dummy boneInverse matrix\n\t\t\t\t\t\t// for the respective bone. This bone won't affect any vertices, because there are no skin indices\n\t\t\t\t\t\t// and weights defined for it. But we still have to add the bone to the sorted bone list in order to\n\t\t\t\t\t\t// ensure a correct animation of the model.\n\n\t\t\t\t\t\tboneInverse = new THREE.Matrix4();\n\n\t\t\t\t\t}\n\n\t\t\t\t\tboneData.push( { bone: object, boneInverse: boneInverse, processed: false } );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t}\n\n\t\tfunction buildNode( data ) {\n\n\t\t\tvar objects = [];\n\n\t\t\tvar matrix = data.matrix;\n\t\t\tvar nodes = data.nodes;\n\t\t\tvar type = data.type;\n\t\t\tvar instanceCameras = data.instanceCameras;\n\t\t\tvar instanceControllers = data.instanceControllers;\n\t\t\tvar instanceLights = data.instanceLights;\n\t\t\tvar instanceGeometries = data.instanceGeometries;\n\t\t\tvar instanceNodes = data.instanceNodes;\n\n\t\t\t// nodes\n\n\t\t\tfor ( var i = 0, l = nodes.length; i < l; i ++ ) {\n\n\t\t\t\tobjects.push( getNode( nodes[ i ] ) );\n\n\t\t\t}\n\n\t\t\t// instance cameras\n\n\t\t\tfor ( var i = 0, l = instanceCameras.length; i < l; i ++ ) {\n\n\t\t\t\tvar instanceCamera = getCamera( instanceCameras[ i ] );\n\n\t\t\t\tif ( instanceCamera !== null ) {\n\n\t\t\t\t\tobjects.push( instanceCamera.clone() );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// instance controllers\n\n\t\t\tfor ( var i = 0, l = instanceControllers.length; i < l; i ++ ) {\n\n\t\t\t\tvar instance = instanceControllers[ i ];\n\t\t\t\tvar controller = getController( instance.id );\n\t\t\t\tvar geometries = getGeometry( controller.id );\n\t\t\t\tvar newObjects = buildObjects( geometries, instance.materials );\n\n\t\t\t\tvar skeletons = instance.skeletons;\n\t\t\t\tvar joints = controller.skin.joints;\n\n\t\t\t\tvar skeleton = buildSkeleton( skeletons, joints );\n\n\t\t\t\tfor ( var j = 0, jl = newObjects.length; j < jl; j ++ ) {\n\n\t\t\t\t\tvar object = newObjects[ j ];\n\n\t\t\t\t\tif ( object.isSkinnedMesh ) {\n\n\t\t\t\t\t\tobject.bind( skeleton, controller.skin.bindMatrix );\n\t\t\t\t\t\tobject.normalizeSkinWeights();\n\n\t\t\t\t\t}\n\n\t\t\t\t\tobjects.push( object );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// instance lights\n\n\t\t\tfor ( var i = 0, l = instanceLights.length; i < l; i ++ ) {\n\n\t\t\t\tvar instanceLight = getLight( instanceLights[ i ] );\n\n\t\t\t\tif ( instanceLight !== null ) {\n\n\t\t\t\t\tobjects.push( instanceLight.clone() );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// instance geometries\n\n\t\t\tfor ( var i = 0, l = instanceGeometries.length; i < l; i ++ ) {\n\n\t\t\t\tvar instance = instanceGeometries[ i ];\n\n\t\t\t\t// a single geometry instance in collada can lead to multiple object3Ds.\n\t\t\t\t// this is the case when primitives are combined like triangles and lines\n\n\t\t\t\tvar geometries = getGeometry( instance.id );\n\t\t\t\tvar newObjects = buildObjects( geometries, instance.materials );\n\n\t\t\t\tfor ( var j = 0, jl = newObjects.length; j < jl; j ++ ) {\n\n\t\t\t\t\tobjects.push( newObjects[ j ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// instance nodes\n\n\t\t\tfor ( var i = 0, l = instanceNodes.length; i < l; i ++ ) {\n\n\t\t\t\tobjects.push( getNode( instanceNodes[ i ] ).clone() );\n\n\t\t\t}\n\n\t\t\tvar object;\n\n\t\t\tif ( nodes.length === 0 && objects.length === 1 ) {\n\n\t\t\t\tobject = objects[ 0 ];\n\n\t\t\t} else {\n\n\t\t\t\tobject = ( type === 'JOINT' ) ? new THREE.Bone() : new THREE.Group();\n\n\t\t\t\tfor ( var i = 0; i < objects.length; i ++ ) {\n\n\t\t\t\t\tobject.add( objects[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( object.name === '' ) {\n\n\t\t\t\tobject.name = ( type === 'JOINT' ) ? data.sid : data.name;\n\n\t\t\t}\n\n\t\t\tobject.matrix.copy( matrix );\n\t\t\tobject.matrix.decompose( object.position, object.quaternion, object.scale );\n\n\t\t\treturn object;\n\n\t\t}\n\n\t\tfunction resolveMaterialBinding( keys, instanceMaterials ) {\n\n\t\t\tvar materials = [];\n\n\t\t\tfor ( var i = 0, l = keys.length; i < l; i ++ ) {\n\n\t\t\t\tvar id = instanceMaterials[ keys[ i ] ];\n\t\t\t\tmaterials.push( getMaterial( id ) );\n\n\t\t\t}\n\n\t\t\treturn materials;\n\n\t\t}\n\n\t\tfunction buildObjects( geometries, instanceMaterials ) {\n\n\t\t\tvar objects = [];\n\n\t\t\tfor ( var type in geometries ) {\n\n\t\t\t\tvar geometry = geometries[ type ];\n\n\t\t\t\tvar materials = resolveMaterialBinding( geometry.materialKeys, instanceMaterials );\n\n\t\t\t\t// handle case if no materials are defined\n\n\t\t\t\tif ( materials.length === 0 ) {\n\n\t\t\t\t\tif ( type === 'lines' || type === 'linestrips' ) {\n\n\t\t\t\t\t\tmaterials.push( new THREE.LineBasicMaterial() );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tmaterials.push( new THREE.MeshPhongMaterial() );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// regard skinning\n\n\t\t\t\tvar skinning = ( geometry.data.attributes.skinIndex !== undefined );\n\n\t\t\t\tif ( skinning ) {\n\n\t\t\t\t\tfor ( var i = 0, l = materials.length; i < l; i ++ ) {\n\n\t\t\t\t\t\tmaterials[ i ].skinning = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// choose between a single or multi materials (material array)\n\n\t\t\t\tvar material = ( materials.length === 1 ) ? materials[ 0 ] : materials;\n\n\t\t\t\t// now create a specific 3D object\n\n\t\t\t\tvar object;\n\n\t\t\t\tswitch ( type ) {\n\n\t\t\t\t\tcase 'lines':\n\t\t\t\t\t\tobject = new THREE.LineSegments( geometry.data, material );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'linestrips':\n\t\t\t\t\t\tobject = new THREE.Line( geometry.data, material );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'triangles':\n\t\t\t\t\tcase 'polylist':\n\t\t\t\t\t\tif ( skinning ) {\n\n\t\t\t\t\t\t\tobject = new THREE.SkinnedMesh( geometry.data, material );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tobject = new THREE.Mesh( geometry.data, material );\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tobjects.push( object );\n\n\t\t\t}\n\n\t\t\treturn objects;\n\n\t\t}\n\n\t\tfunction hasNode( id ) {\n\n\t\t\treturn library.nodes[ id ] !== undefined;\n\n\t\t}\n\n\t\tfunction getNode( id ) {\n\n\t\t\treturn getBuild( library.nodes[ id ], buildNode );\n\n\t\t}\n\n\t\t// visual scenes\n\n\t\tfunction parseVisualScene( xml ) {\n\n\t\t\tvar data = {\n\t\t\t\tname: xml.getAttribute( 'name' ),\n\t\t\t\tchildren: []\n\t\t\t};\n\n\t\t\tprepareNodes( xml );\n\n\t\t\tvar elements = getElementsByTagName( xml, 'node' );\n\n\t\t\tfor ( var i = 0; i < elements.length; i ++ ) {\n\n\t\t\t\tdata.children.push( parseNode( elements[ i ] ) );\n\n\t\t\t}\n\n\t\t\tlibrary.visualScenes[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction buildVisualScene( data ) {\n\n\t\t\tvar group = new THREE.Group();\n\t\t\tgroup.name = data.name;\n\n\t\t\tvar children = data.children;\n\n\t\t\tfor ( var i = 0; i < children.length; i ++ ) {\n\n\t\t\t\tvar child = children[ i ];\n\n\t\t\t\tgroup.add( getNode( child.id ) );\n\n\t\t\t}\n\n\t\t\treturn group;\n\n\t\t}\n\n\t\tfunction hasVisualScene( id ) {\n\n\t\t\treturn library.visualScenes[ id ] !== undefined;\n\n\t\t}\n\n\t\tfunction getVisualScene( id ) {\n\n\t\t\treturn getBuild( library.visualScenes[ id ], buildVisualScene );\n\n\t\t}\n\n\t\t// scenes\n\n\t\tfunction parseScene( xml ) {\n\n\t\t\tvar instance = getElementsByTagName( xml, 'instance_visual_scene' )[ 0 ];\n\t\t\treturn getVisualScene( parseId( instance.getAttribute( 'url' ) ) );\n\n\t\t}\n\n\t\tfunction setupAnimations() {\n\n\t\t\tvar clips = library.clips;\n\n\t\t\tif ( isEmpty( clips ) === true ) {\n\n\t\t\t\tif ( isEmpty( library.animations ) === false ) {\n\n\t\t\t\t\t// if there are animations but no clips, we create a default clip for playback\n\n\t\t\t\t\tvar tracks = [];\n\n\t\t\t\t\tfor ( var id in library.animations ) {\n\n\t\t\t\t\t\tvar animationTracks = getAnimation( id );\n\n\t\t\t\t\t\tfor ( var i = 0, l = animationTracks.length; i < l; i ++ ) {\n\n\t\t\t\t\t\t\ttracks.push( animationTracks[ i ] );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tanimations.push( new THREE.AnimationClip( 'default', - 1, tracks ) );\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tfor ( var id in clips ) {\n\n\t\t\t\t\tanimations.push( getAnimationClip( id ) );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( text.length === 0 ) {\n\n\t\t\treturn { scene: new THREE.Scene() };\n\n\t\t}\n\n\t\tvar xml = new DOMParser().parseFromString( text, 'application/xml' );\n\n\t\tvar collada = getElementsByTagName( xml, 'COLLADA' )[ 0 ];\n\n\t\t// metadata\n\n\t\tvar version = collada.getAttribute( 'version' );\n\t\tconsole.log( 'THREE.ColladaLoader: File version', version );\n\n\t\tvar asset = parseAsset( getElementsByTagName( collada, 'asset' )[ 0 ] );\n\t\tvar textureLoader = new THREE.TextureLoader( this.manager );\n\t\ttextureLoader.setPath( path ).setCrossOrigin( this.crossOrigin );\n\n\t\t//\n\n\t\tvar animations = [];\n\t\tvar kinematics = {};\n\t\tvar count = 0;\n\n\t\t//\n\n\t\tvar library = {\n\t\t\tanimations: {},\n\t\t\tclips: {},\n\t\t\tcontrollers: {},\n\t\t\timages: {},\n\t\t\teffects: {},\n\t\t\tmaterials: {},\n\t\t\tcameras: {},\n\t\t\tlights: {},\n\t\t\tgeometries: {},\n\t\t\tnodes: {},\n\t\t\tvisualScenes: {},\n\t\t\tkinematicsModels: {},\n\t\t\tphysicsModels: {},\n\t\t\tkinematicsScenes: {}\n\t\t};\n\n\t\tparseLibrary( collada, 'library_animations', 'animation', parseAnimation );\n\t\tparseLibrary( collada, 'library_animation_clips', 'animation_clip', parseAnimationClip );\n\t\tparseLibrary( collada, 'library_controllers', 'controller', parseController );\n\t\tparseLibrary( collada, 'library_images', 'image', parseImage );\n\t\tparseLibrary( collada, 'library_effects', 'effect', parseEffect );\n\t\tparseLibrary( collada, 'library_materials', 'material', parseMaterial );\n\t\tparseLibrary( collada, 'library_cameras', 'camera', parseCamera );\n\t\tparseLibrary( collada, 'library_lights', 'light', parseLight );\n\t\tparseLibrary( collada, 'library_geometries', 'geometry', parseGeometry );\n\t\tparseLibrary( collada, 'library_nodes', 'node', parseNode );\n\t\tparseLibrary( collada, 'library_visual_scenes', 'visual_scene', parseVisualScene );\n\t\tparseLibrary( collada, 'library_kinematics_models', 'kinematics_model', parseKinematicsModel );\n\t\tparseLibrary( collada, 'library_physics_models', 'physics_model', parsePhysicsModel );\n\t\tparseLibrary( collada, 'scene', 'instance_kinematics_scene', parseKinematicsScene );\n\n\t\tbuildLibrary( library.animations, buildAnimation );\n\t\tbuildLibrary( library.clips, buildAnimationClip );\n\t\tbuildLibrary( library.controllers, buildController );\n\t\tbuildLibrary( library.images, buildImage );\n\t\tbuildLibrary( library.effects, buildEffect );\n\t\tbuildLibrary( library.materials, buildMaterial );\n\t\tbuildLibrary( library.cameras, buildCamera );\n\t\tbuildLibrary( library.lights, buildLight );\n\t\tbuildLibrary( library.geometries, buildGeometry );\n\t\tbuildLibrary( library.visualScenes, buildVisualScene );\n\n\t\tsetupAnimations();\n\t\tsetupKinematics();\n\n\t\tvar scene = parseScene( getElementsByTagName( collada, 'scene' )[ 0 ] );\n\n\t\tif ( asset.upAxis === 'Z_UP' ) {\n\n\t\t\tscene.quaternion.setFromEuler( new THREE.Euler( - Math.PI / 2, 0, 0 ) );\n\n\t\t}\n\n\t\tscene.scale.multiplyScalar( asset.unit );\n\n\t\treturn {\n\t\t\tanimations: animations,\n\t\t\tkinematics: kinematics,\n\t\t\tlibrary: library,\n\t\t\tscene: scene\n\t\t};\n\n\t}\n\n};\n","import 'three/examples/js/loaders/OBJLoader'\nimport 'three/examples/js/loaders/MTLLoader'\nimport 'three/examples/js/loaders/ColladaLoader'\n\nimport { Object3D } from './Object3D'\nwindow.m = new Three.MeshNormalMaterial()\n\nexport class File3D extends Object3D {\n\tobjLoader = new Three.OBJLoader()\n\tmatLoader = new Three.MTLLoader()\n\tcolladaLoader = new Three.ColladaLoader()\n\tcomponentDidMount() {\n\t\tthis.matLoader.setPath('/ss-virtual-showroom/assets/').load(this.props.mtl, material => {\n\t\t\tconsole.log(material)\n\t\t\tconsole.log('fdsfgdsf')\n\t\t\t// material.preload()\n\t\t\tthis.objLoader\n\t\t\t\t.setMaterials(material)\n\t\t\t\t.setPath('/ss-virtual-showroom/assets/')\n\t\t\t\t.load(this.props.obj, object => {\n\t\t\t\t\tconsole.log(object)\n\t\t\t\t\tthis.object = this.enhance(object)\n\t\t\t\t\tif (this.parent) this.parent.object.add(this.object)\n\t\t\t\t})\n\t\t})\n\t\t// this.colladaLoader.load('/ss-virtual-showroom/assets/' + this.props.dae, object => {\n\t\t// \tconsole.log(object)\n\t\t// \tthis.object = this.enhance(object.scene)\n\t\t// \tif (this.parent) this.parent.object.add(this.object)\n\t\t// })\n\t}\n\tenhance = object => {\n\t\tif (object.type === 'Mesh') {\n\t\t\tobject.castShadow = true\n\t\t\tobject.receiveShadow = true\n\t\t\tconst materials = Array.isArray(object.material) ? object.material : [object.material]\n\t\t\tmaterials.forEach(material => {\n\t\t\t\t// console.log(material)\n\t\t\t\t// material.color.set('red')\n\t\t\t})\n\t\t}\n\t\t// object.material = m\n\t\tobject.children.forEach(this.enhance)\n\t\treturn object\n\t}\n}\n","import 'three/src/helpers/GridHelper'\n\nimport { Object3D } from './Object3D'\n\nexport class Floor3D extends Object3D {\n\tconstructor(props) {\n\t\tsuper(props)\n\t\tconst material = new Three.MeshPhysicalMaterial()\n\t\tconst geometry = new Three.PlaneBufferGeometry(10, 10)\n\t\tconst plane = new Three.Mesh(geometry, material)\n\t\tplane.rotation.x = Math.PI / -2\n\t\tplane.receiveShadow = true\n\t\tplane.castShadow = true\n\n\t\tconst grid = new Three.GridHelper(10, 10)\n\n\t\tthis.object = new Three.Group()\n\t\tthis.object.add(plane)\n\t\tthis.object.add(grid)\n\n\t\tnew Three.TextureLoader().setPath('/ss-virtual-showroom/assets/').load('UV_Grid_Sm.jpg', texture => {\n\t\t\ttexture.mapping = Three.UVMapping\n\t\t\ttexture.wrapS = Three.RepeatWrapping\n\t\t\ttexture.wrapT = Three.RepeatWrapping\n\t\t\ttexture.repeat.set(1, 1)\n\t\t\tmaterial.map = texture\n\t\t\tmaterial.needsUpdate = true\n\t\t})\n\t}\n}\n","export const ParentContext = React.createContext(null)\n\nexport class Object3D extends React.Component {\n\tstatic propTypes = {\n\t\tchildren: PropTypes.node\n\t}\n\tstatic defaultProps = {\n\t\tchildren: null\n\t}\n\tstatic contextTypes = {\n\t\tscene: PropTypes.instanceOf(React.Component),\n\t\tparent: PropTypes.instanceOf(React.Component)\n\t}\n\tstatic childContextTypes = {\n\t\tscene: PropTypes.instanceOf(React.Component),\n\t\tparent: PropTypes.instanceOf(React.Component)\n\t}\n\tgetChildContext() {\n\t\treturn {\n\t\t\tparent: this\n\t\t}\n\t}\n\tget parent() {\n\t\treturn this.context.parent\n\t}\n\tget scene() {\n\t\treturn this.context.scene\n\t}\n\tcomponentDidMount() {\n\t\tif (this.object && this.parent) {\n\t\t\tthis.parent.object.add(this.object)\n\t\t}\n\t\tthis.update()\n\t}\n\tcomponentDidUpdate() {\n\t\tthis.update()\n\t}\n\tcomponentWillUnmount() {\n\t\tif (this.object && this.parent) {\n\t\t\tthis.parent.object.remove(this.object)\n\t\t}\n\t}\n\tupdate() {}\n\trender() {\n\t\treturn this.props.children\n\t}\n}\n","import 'three/examples/js/controls/FlyControls'\nimport 'three/examples/js/controls/MapControls'\nimport 'three/examples/js/controls/OrbitControls'\nimport 'three/examples/js/controls/PointerLockControls'\n\nimport { Object3D } from './Object3D'\n\nexport class Scene3D extends Object3D {\n\tstatic propTypes = {\n\t\tchildren: PropTypes.node,\n\t\tantialias: PropTypes.bool,\n\t\tcontrols: PropTypes.oneOf(['fpv', 'fly', 'map', 'orbit']),\n\t\tfar: PropTypes.number,\n\t\tfov: PropTypes.number,\n\t\tnear: PropTypes.number,\n\t\tzoom: PropTypes.number\n\t}\n\tstatic defaultProps = {\n\t\tchildren: null,\n\t\tantialias: true,\n\t\tcontrols: 'orbit',\n\t\tfar: 4000,\n\t\tfov: 60,\n\t\tnear: 0.01,\n\t\tzoom: 1\n\t}\n\tgetChildContext() {\n\t\treturn {\n\t\t\t...super.getChildContext(),\n\t\t\tscene: this\n\t\t}\n\t}\n\tclock = new Three.Clock()\n\twrapper = React.createRef()\n\tobject = new Three.Scene()\n\tcamera = new Three.PerspectiveCamera()\n\trenderer = new Three.WebGLRenderer({ antialias: true })\n\tcontrols = {\n\t\t// fpv: new Three.PointerLockControls(this.camera),\n\t\t// fly: new Three.FlyControls(this.camera),\n\t\t// map: new Three.MapControls(this.camera),\n\t\t// orbit: new Three.OrbitControls(this.camera)\n\t}\n\n\tcomponentDidMount() {\n\t\twindow.v = this\n\t\tthis.mounted = true\n\t\t// this.controls.map.enabled = false\n\t\t// this.controls.orbit.enabled = false\n\t\t// this.controls.screenSpacePanning = true\n\t\t// this.controls.fly.enabled = false\n\t\t// this.controls.fpv.enabled = false\n\t\tthis.wrapper.current.appendChild(this.renderer.domElement)\n\t\tthis.camera.position.set(-2, 5, 7)\n\t\t// this.object.add(this.controls.fpv.getObject())\n\t\t// this.controls.fly.dragToLook = false\n\t\t// this.controls.fly.movementSpeed = 1\n\t\t// this.controls.fly.rollSpeed = 0.5\n\t\t// this.controls.map.target.set(0, 2, 0)\n\t\t// this.controls.orbit.target.set(0, 1, 0)\n\t\taddEventListener('resize', this.update, true)\n\t\tthis.update()\n\t\tthis.animate()\n\n\t\t// Test objects\n\t\t// new Three.TextureLoader().setPath('/ss-virtual-showroom/assets/').load('metal.jpg', texture => {\n\t\t// \ttexture.mapping = Three.SphericalReflectionMapping\n\t\t// \tconst geometry = new Three.SphereGeometry(0.5, 48, 48)\n\t\t// \tconst material = new Three.MeshLambertMaterial({\n\t\t// \t\tenvMap: texture\n\t\t// \t})\n\t\t// \tthis.box = new Three.Mesh(geometry, material)\n\t\t// \tthis.box.position.set(-1.5, 0.5, 0)\n\t\t// \tthis.box.castShadow = true\n\t\t// \tthis.object.add(this.box)\n\t\t// \tthis.update()\n\t\t// })\n\t\t// new Three.TextureLoader()\n\t\t// \t.setPath('/ss-virtual-showroom/assets/')\n\t\t// \t.load('2294472375_24a3b8ef46_o.jpg', texture => {\n\t\t// \t\ttexture.mapping = Three.EquirectangularReflectionMapping\n\t\t// \t\tconst geometry = new Three.SphereGeometry(0.5, 48, 48)\n\t\t// \t\tconst material = new Three.MeshPhongMaterial({\n\t\t// \t\t\tenvMap: texture,\n\t\t// \t\t\temissive: 0.5,\n\t\t// \t\t\treflectivity: 0.7\n\t\t// \t\t})\n\t\t// \t\tthis.box = new Three.Mesh(geometry, material)\n\t\t// \t\tthis.box.position.set(1.5, 0.5, 0)\n\t\t// \t\tthis.box.castShadow = true\n\t\t// \t\tthis.object.add(this.box)\n\t\t// \t\tthis.update()\n\t\t// \t})\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.mounted = false\n\t\tremoveEventListener('resize', this.update, true)\n\t}\n\n\tupdate = () => {\n\t\tconst width = window.innerWidth\n\t\tconst height = window.innerHeight\n\t\tthis.camera.fov = this.props.fov\n\t\tthis.camera.far = this.props.far\n\t\tthis.camera.near = this.props.near\n\t\tthis.camera.aspect = width / height\n\t\tthis.camera.updateProjectionMatrix()\n\t\tthis.renderer.setSize(width, height)\n\t\tthis.renderer.shadowMap.enabled = true\n\t\tthis.renderer.antialias = this.props.antialias\n\t\t// if (this.controls.current !== this.controls[this.props.controls]) {\n\t\t// \tif (this.controls.current) {\n\t\t// \t\tthis.controls.current.enabled = false\n\t\t// \t}\n\t\t// \tthis.controls.current = this.controls[this.props.controls]\n\t\t// \tthis.controls.current.enabled = true\n\t\t// }\n\t}\n\n\tanimate = () => {\n\t\t// this.controls.current.update()\n\t\tthis.renderer.render(this.object, this.camera)\n\t\tif (this.mounted) {\n\t\t\trequestAnimationFrame(this.animate)\n\t\t}\n\t}\n\thandleClick = e => {\n\t\t// e.currentTarget.requestPointerLock()\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div ref={this.wrapper} onClick={this.handleClick}>\n\t\t\t\t{this.props.children}\n\t\t\t</div>\n\t\t)\n\t}\n}\n","import { Object3D } from 'Object3D'\n\nimport 'three/examples/js/objects/Sky'\n\nexport class Sky3D extends Object3D {\n\tstatic propTypes = {\n\t\t...Object3D.propTypes,\n\t\tazimuth: PropTypes.number,\n\t\tinclination: PropTypes.number,\n\t\trayleigh: PropTypes.number,\n\t\tturbidity: PropTypes.number,\n\t\tluminance: PropTypes.number,\n\t\tmieCoefficient: PropTypes.number,\n\t\tmieDirectionalG: PropTypes.number\n\t}\n\n\tstatic defaultProps = {\n\t\t...Object3D.defaultProps,\n\t\tazimuth: 0.28,\n\t\tinclination: -0.15,\n\t\trayleigh: 2,\n\t\tturbidity: 10,\n\t\tluminance: 1,\n\t\tmieCoefficient: 0.003,\n\t\tmieDirectionalG: 0.8\n\t}\n\tsky = new Three.Sky()\n\tlight = new Three.DirectionalLight()\n\tambient = new Three.HemisphereLight()\n\tobject = Object.assign(new Three.Group(), { children: [this.sky, this.light, this.ambient] })\n\n\tupdate() {\n\t\tconst { sky, light, ambient } = this\n\t\tconst distance = 100\n\n\t\tconst { inclination, azimuth, turbidity, rayleigh, luminance, mieCoefficient, mieDirectionalG } = this.props\n\n\t\tconst theta = Math.PI * (inclination - 0.5)\n\t\tconst phi = 2 * Math.PI * (azimuth - 0.5)\n\t\tconst sunX = distance * Math.cos(phi)\n\t\tconst sunY = distance * Math.sin(phi) * Math.sin(theta)\n\t\tconst sunZ = distance * Math.sin(phi) * Math.cos(theta)\n\n\t\tsky.scale.setScalar(400000)\n\n\t\tsky.material.uniforms.turbidity.value = turbidity\n\t\tsky.material.uniforms.rayleigh.value = rayleigh\n\t\tsky.material.uniforms.luminance.value = luminance\n\t\tsky.material.uniforms.mieCoefficient.value = mieCoefficient\n\t\tsky.material.uniforms.mieDirectionalG.value = mieDirectionalG\n\t\tsky.material.uniforms.sunPosition.value.set(sunX, sunY, sunZ)\n\n\t\tlight.castShadow = true\n\t\tlight.position.copy(sky.material.uniforms.sunPosition.value)\n\t\tlight.intensity = 1\n\t\tlight.color.setHSL(0.1, 1, 0.95)\n\t\tlight.shadow.mapSize.width = 4096\n\t\tlight.shadow.mapSize.height = 4096\n\n\t\tambient.intensity = 0.6\n\t\tambient.color.setHSL(0.6, 1, 0.6)\n\t\tambient.groundColor.setHSL(0.095, 1, 0.75)\n\t\tambient.position.set(0, 50, 0)\n\t}\n}\n","export * from './Scene3D'\nexport * from './Object3D'\nexport * from './Floor3D'\nexport * from './File3D'\nexport * from './Sky3D'\n","module.exports = __WEBPACK_EXTERNAL_MODULE_prop_types__;","module.exports = __WEBPACK_EXTERNAL_MODULE_react__;","module.exports = __WEBPACK_EXTERNAL_MODULE_three__;","module.exports = __WEBPACK_EXTERNAL_MODULE_three_examples_js_controls_FlyControls__;","module.exports = __WEBPACK_EXTERNAL_MODULE_three_examples_js_controls_MapControls__;","module.exports = __WEBPACK_EXTERNAL_MODULE_three_examples_js_controls_OrbitControls__;","module.exports = __WEBPACK_EXTERNAL_MODULE_three_examples_js_controls_PointerLockControls__;","module.exports = __WEBPACK_EXTERNAL_MODULE_three_examples_js_loaders_MTLLoader__;","module.exports = __WEBPACK_EXTERNAL_MODULE_three_examples_js_loaders_OBJLoader__;","module.exports = __WEBPACK_EXTERNAL_MODULE_three_examples_js_objects_Sky__;","module.exports = __WEBPACK_EXTERNAL_MODULE_three_src_helpers_GridHelper__;"],"sourceRoot":""}